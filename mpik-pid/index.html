<!-- $Id$
 *
 * Red Pitaya PID & Oscilloscope client.
 * Changed Version for QUEST at PTB
 * optimized for the MPIK by Patrick Knauer
 *
 * Author: Dakus <info@eskala.eu>
 * Changes from Fenske
 * even more changes by Patrick
 * (c) Red Pitaya  http://www.redpitaya.com
 *
 * This part of code is written in Javascript & HTML.
 * Please visit http://en.wikipedia.org/wiki/JavaScript
 *              http://en.wikipedia.org/wiki/HTML
 * for more details on the languages used herein.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MPIK-PID Controller</title>
  <link href="../assets/bootstrap-3.0.0/css/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../assets/examples.css" rel="stylesheet" type="text/css">
  <link href="../assets/style.css?6" rel="stylesheet" type="text/css">
  <link href="generaloverview.css" rel="stylesheet" type="text/css">
  <script src="../assets/bootstrap-3.0.0/js/jquery.js"></script>
  <script src="../assets/bootstrap-3.0.0/js/bootstrap.min.js"></script>
  <script src="../assets/flot/jquery.flot.min.js"></script>
  <script src="../assets/flot/jquery.flot.selection.min.js"></script>
  <script src="../assets/flot/jquery.flot.navigate.js"></script>
  <script src="../assets/flot/jquery.flot.resize.min.js"></script>
  <script src="../assets/flot/jquery.flot.touch.js?2"></script>
  <script src="js/jqBarGraph.js"></script> 
  <script type="text/javascript">
  

  // Settings which can be modified
  // "../assets/bootstrap-3.0.0/js/jqBarGraph.js"> 

  var app_id = 'mpik-pid';
  var root_url = '';
  //var root_url = 'http://10.0.1.221';      // Test local
  //var root_url = 'http://192.168.53.133';  // Test remote and local
  //var root_url = 'http://192.168.1.100';   // Default RedPitaya IP
  var start_app_url = root_url + '/bazaar?start=' + app_id;
  var stop_app_url = root_url + '/bazaar?stop=';
  var get_url = root_url + '/data';
  var post_url = root_url + '/data';

  var update_interval = 25;              // Update interval for PC, milliseconds
  var update_interval_mobdev = 500;      // Update interval for mobile devices, milliseconds
  var request_timeout = 3000;            // Milliseconds
  var long_timeout = 20000;              // Milliseconds
  var meas_panel_dec = 2;                // Decimation for numerical measure panel to make it human readable
  var meas_panel_dec_mobdev = 1;         // Decimation for numerical measure panel for mobile devices
  var points_per_px = 5;                 // How many points per pixel should be drawn. Set null for unlimited (will disable client side decimation).
  var xdecimal_places = 2;               // Number of decimal places for the xmin/xmax values. Maximum supported are 12.
  var trigger_level_xdecimal_places = 4; // Number of decimal places for trigger level tooltip
  var range_offset = 1;                  // Percentages

  var xmin = -1000000;
  var xmax = 1000000;

  var time_range_max = [130, 1000, 8, 130, 1, 8];
  var range_steps = [0.5, 1, 2, 5, 10, 20, 50, 100];

  var plot_options = {
    colors: ['#3276B1', '#D2322D', '#009900'],    
    lines: { lineWidth: 1 },
    selection: { mode: 'xy' },
    zoom: { interactive: true, trigger: null },
    xaxis: { min: xmin, max: xmax },
    grid: { borderWidth: 0 },
    legend: { noColumns: 2, margin: [0, 0], backgroundColor: 'transparent' },
    touch: { autoWidth: false, autoHeight: false }
  };

  // Settings which should not be modified


  var update_timer = null;
  var zoompan_timer = null;
  var downloading = false;
  var sending = false;
  var send_que = false;
  var use_long_timeout = false;
  var trig_dragging = false;
  var touch_last_y = 0;
  var user_editing = false;
  var app_started = false;
  var last_get_failed = false;
  var refresh_counter = 0;
  var autorun = 1;
  var datasets = [];
  var plot = null;
  var params = {
    original: null,
    local: null
  };

  // Default parameters - posted after server side app is started
  var def_params = {
    en_avg_at_dec: 0
  };

  // On page loaded

  $(function() {

    // Show different buttons on touch screens
    if(window.ontouchstart === undefined) {
      $('.btn-lg').removeClass('btn-lg');
      $('#accordion .btn, .modal .btn').addClass('btn-sm');
      $('#btn_zoompan').remove();
      $('#btn_zoomin, #btn_zoomout, #btn_pan').show();
    }
    else {
      update_interval = update_interval_mobdev;
      meas_panel_dec = meas_panel_dec_mobdev;
      $('#btn_zoomin, #btn_zoomout, #btn_pan').remove();
      $('#btn_zoompan').show();
    }

    // Add application ID in the message from modal popup
    $('.app-id').text(app_id);

    // Disable all controls until the params state is loaded for the first time
    $('input, select, button', '.container').prop('disabled', true);

    // Events binding for trigger controls

    $('#trigger_canvas').on({
      'mousedown touchstart': function(evt) {

        // Ignore the event if trigger source is External or mode is not Normal
        if(!params.original || params.original.trig_mode != 1 || params.original.trig_source == 2) {
          return;
        }

        trig_dragging = true;
        $('input, select', '#accordion').blur();
        mouseDownMove(this, evt);
        evt.preventDefault();
        return false;
      },
      'mousemove touchmove': function(evt) {
        if(! trig_dragging) {
          return;
        }
        mouseDownMove(this, evt);
        evt.preventDefault();
        return false;
      },
      'mouseup mouseout touchend': mouseUpOut
    });

    $('input,select', '#accordion').on('focus', function() {
      user_editing = true;
    });

    $('#trig_mode').on('change', function() {
      onDropdownChange($(this), 'trig_mode', true);

      // Autorun if trigger mode is Auto(0) or Normal(1), stop if it is Single(2).
      autorun = (params.local.trig_mode == 2 ? 0 : 1);
      runStop();
    });

    $('#trig_source').on('change', function() { onDropdownChange($(this), 'trig_source'); });
    $('#trig_edge').on('change', function() { onDropdownChange($(this), 'trig_edge'); });

    $('#trig_level')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_trig_level').show();
      })
      .on('blur', function() {
        $('#apply_trig_level').hide();
        $(this).parent().removeClass('input-group');

        var tlev = parseLocalFloat($(this).val());
        if(! isNaN(tlev)) {
          params.local.trig_level = tlev;
          updateTriggerSlider(undefined, false);
          redrawPlot();
          sendParams();
        }
        else {
          $(this).val(params.local.trig_level)
        }
        user_editing = false;
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

    // Events binding for range controls

    $('#range_x_minus, #range_x_plus').on('click', function() {
      var nearest = $(this).data('nearest');

      if(nearest && plot) {
        var options = plot.getOptions();
        var axes = plot.getAxes();
        var min = (options.xaxes[0].min !== null ? options.xaxes[0].min : axes.xaxis.min);
        var max = (options.xaxes[0].max !== null ? options.xaxes[0].max : axes.xaxis.max);
        var unit = $(this).data('unit');

        // Convert nanoseconds to milliseconds.
        if(unit == 'ns') {
          nearest /= 1000;
        }

        var center = (min + max) / 2;
        var half = nearest / 2;
        min = center - half;
        max = center + half;

        options.xaxes[0].min = min;
        options.xaxes[0].max = max;

        plot.setupGrid();
        plot.draw();

        params.local.xmin = min;
        params.local.xmax = max;

        updateRanges();
        $(this).tooltip($(this).prop('disabled') === true ? 'hide' : 'show');
        sendParams(true);
      }
    });

    $('#range_y_minus, #range_y_plus').on('click', function() {
      var nearest = $(this).data('nearest');

      if(nearest && plot) {
        var options = plot.getOptions();
        var axes = plot.getAxes();
        var min = (options.yaxes[0].min !== null ? options.yaxes[0].min : axes.yaxis.min);
        var max = (options.yaxes[0].max !== null ? options.yaxes[0].max : axes.yaxis.max);
        var unit = $(this).data('unit');

        // Convert millivolts to volts.
        if(unit == 'mV') {
          nearest /= 1000;
        }

        var center = (min + max) / 2;
        var half = nearest / 2;
        min = center - half;
        max = center + half;

        options.yaxes[0].min = min;
        options.yaxes[0].max = max;

        plot.setupGrid();
        plot.draw();

        updateRanges();
        $(this).tooltip($(this).prop('disabled') === true ? 'hide' : 'show');
        updateTriggerSlider();
      }
    });

    $('#offset_x_minus, #offset_x_plus').on('click', function() {
      if(plot) {
        var direction = ($(this).attr('id') == 'offset_x_minus' ? 'left' : 'right');
        var options = plot.getOptions();
        var axes = plot.getAxes();
        var min = (options.xaxes[0].min !== null ? options.xaxes[0].min : axes.xaxis.min);
        var max = (options.xaxes[0].max !== null ? options.xaxes[0].max : axes.xaxis.max);
        var offset = (max - min) * range_offset/100;

        if(direction == 'left') {
          min -= offset;
          max -= offset;
        }
        else {
          min += offset;
          max += offset;
        }

        options.xaxes[0].min = min;
        options.xaxes[0].max = max;

        plot.setupGrid();
        plot.draw();

        params.local.xmin = min;
        params.local.xmax = max;

        updateRanges();
        sendParams(true);
      }
    });

    $('#offset_y_minus, #offset_y_plus').on('click', function() {
      if(plot) {
        var direction = ($(this).attr('id') == 'offset_y_minus' ? 'down' : 'up');
        var options = plot.getOptions();
        var axes = plot.getAxes();
        var min = (options.yaxes[0].min !== null ? options.yaxes[0].min : axes.yaxis.min);
        var max = (options.yaxes[0].max !== null ? options.yaxes[0].max : axes.yaxis.max);
        var offset = (max - min) * range_offset/100;

        if(direction == 'down') {
          min -= offset;
          max -= offset;
        }
        else {
          min += offset;
          max += offset;
        }

        options.yaxes[0].min = min;
        options.yaxes[0].max = max;

        plot.setupGrid();
        plot.draw();

        updateRanges();
        updateTriggerSlider();
      }
    });

    // Events binding for gain controls

    $('#gain_ch1_att').on('change', function() { onDropdownChange($(this), 'prb_att_ch1'); });
    $('#gain_ch1_sett').on('change', function() { onDropdownChange($(this), 'gain_ch1'); });
    $('#gain_ch2_att').on('change', function() { onDropdownChange($(this), 'prb_att_ch2'); });
    $('#gain_ch2_sett').on('change', function() { onDropdownChange($(this), 'gain_ch2'); });

    // patrick - events binding for AO settings and piezo control

    //enable AO for each pin and the piezo drive
    $('#AO_enable_pin0, #AO_enable_pin1, #AO_enable_pin2, #AO_enable_pin3, #piezo_enable, #piezo_manual, #manual_dir, #manual_go, #slow_pulses').on('change', function() {
    params.local[this.id] = ($(this).is(':checked') ? 1 : 0);
    sendParams();

	//patrick
	var h = document.getElementById("pienon");
	var i = document.getElementById("pienoff");
	var j = document.getElementById("pimanon");
	var k = document.getElementById("pimanoff");

	if($('#piezo_enable').is(':checked') ? 1 : 0 ){
		h.style.display = "block";
		i.style.display = "none";
	}
	else{
		h.style.display = "none";
		i.style.display = "block";
	}
	if($('#piezo_manual').is(':checked') ? 1 : 0 ){
		j.style.display = "block";
		k.style.display = "none";
	}
	else{
		j.style.display = "none";
		k.style.display = "block";
	}
    });

    //adding on keypress functions

    $(document).keyup(function(e){

	//variables for general overview
	var a = document.getElementById("pid11on");
	var b = document.getElementById("pid11off");
	var c = document.getElementById("ch1on");
	var d = document.getElementById("ch1off");
	var f = document.getElementById("arst11on");
	var g = document.getElementById("arst11off");
	var h = document.getElementById("pienon");
	var i = document.getElementById("pienoff");
	var j = document.getElementById("pimanon");
	var k = document.getElementById("pimanoff");

	if($('#piezo_enable').is(':checked') ? 1 : 0 ){
	    if(e.which == 99){	//numpad 3
		params.local.piezo_enable = 0;
		sendParams();
		h.style.display = "none";
		i.style.display = "block";
	    }
	}
	else{
	    if(e.which == 99){	
		params.local.piezo_enable = 1;
		sendParams();
		h.style.display = "block";
		i.style.display = "none";
	    }
	}

	if($('#pid_11_arst').is(':checked') ? 1 : 0 ){
	    if(e.which == 97){	//numpad 1
		params.local.pid_11_arst = 0;
		sendParams();
		f.style.display = "none";
		g.style.display = "block";
	    }
	}
	else{
	    if(e.which == 97){	
		params.local.pid_11_arst = 1;
		sendParams();
		f.style.display = "block";
		g.style.display = "none";
	    }
	}


	if($('#pid_11_enable').is(':checked') ? 1 : 0 ){
	    if(e.which == 103){	//numpad 7
		params.local.pid_11_enable = 0;
		sendParams();
		a.style.display = "none";
		b.style.display = "block";
	    }
	}
	else{
	    if(e.which == 103){
		params.local.pid_11_enable = 1;
		sendParams();
		a.style.display = "block";
		b.style.display = "none";
	    }
	}
	if($('#gen_enable_ch1').is(':checked') ? 1 : 0 ){
	    if(e.which == 105){	//numpad 9
		params.local.gen_enable_ch1 = 0;
		sendParams();
		c.style.display = "none";
		d.style.display = "block";
	    }
	}
	else{
	    if(e.which == 105){
		params.local.gen_enable_ch1 = 1;
		sendParams();
		c.style.display = "block";
		d.style.display = "none";
	    }	
	}
	if($('#piezo_manual').is(':checked') ? 1 : 0 ){
	    if(e.which == 101){	//numpad 5
		params.local.piezo_manual = 0;
		sendParams();
		j.style.display = "none";
		k.style.display = "block";
	    }
	}
	else{
	    if(e.which == 101){
		params.local.piezo_manual = 1;
		sendParams();
		j.style.display = "block";
		k.style.display = "none";
	    }
	}
	    //drive manual + direction - switched directions to match directions of piezo program
	if(e.which == 39 || e.which == 102){	//37=left arrow, 100=numpad 4
		params.local.manual_dir = 0;
		params.local.manual_go = 1;
		sendParams();
	}
	if(e.which == 37 || e.which == 100){	//39=right arrow, 102=numpad 6
		params.local.manual_dir = 1;
		params.local.manual_go = 1;
		sendParams();
	}
	//changing the number of steps
	if(e.which == 107){	//107=+
		if(params.original.manual_nop <= 1000 && params.original.manual_nop > 100){
		params.local.manual_nop = 100;
		}		
		if(params.original.manual_nop <= 100 && params.original.manual_nop > 10){
		params.local.manual_nop = 10;
		}
		if(params.original.manual_nop <= 10){
		params.local.manual_nop = 1;		
		}
		sendParams();
	}
	if(e.which == 109){	//109=-
		if(params.original.manual_nop < 10 && params.original.manual_nop >= 0){
		params.local.manual_nop = 10;
		}		
		if(params.original.manual_nop < 100 && params.original.manual_nop >= 10){
		params.local.manual_nop = 100;
		}
		//if(params.original.manual_nop < 1000 && params.original.manual_nop >= 100){	dangerous if you accidently go 1000
		//params.local.manual_nop = 1000;		
		//}
		sendParams();
	}
	//changing threshold pid 11 per keyup
	if(e.which == 98){	//98=numpad 2
	params.local.min_i_threshold_1 = params.local.min_i_threshold_1 - 0.1;
	sendParams();
	}
	if(e.which == 104){//numpad 8
	params.local.min_i_threshold_1 = params.local.min_i_threshold_1 + 0.1;
	sendParams();
	}
    });

    //voltage setting for each AO pin
	$('#AO_vol_pin0')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.AO_vol_pin0 += 0.01;
			else
				params.local.AO_vol_pin0 -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.AO_vol_pin0 = val;
          sendParams();
        }
        else {
          $(this).val(params.local.AO_vol_pin0)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

    //changing the threshold for piezo_drive

	//threshold up

	$('#AO_trsh_up')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.AO_trsh_up += 0.01;
			else
				params.local.AO_trsh_up -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.AO_trsh_up = val;
          sendParams();
        }
        else {
          $(this).val(params.local.AO_trsh_up)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	//threshold down

	$('#AO_trsh_down')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.AO_trsh_down += 0.01;
			else
				params.local.AO_trsh_down -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.AO_trsh_down = val;
          sendParams();
        }
        else {
          $(this).val(params.local.AO_trsh_down)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	//pulse length

$('#pulse_len')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pulse_len += 1;
			else
				params.local.pulse_len -= 1;	
			return false;
		})
      })
      .on('blur', function() {
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pulse_len = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pulse_len)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	//deviation checks for laser lock

	$('#dev_checks')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.dev_checks += 10;
			else
				params.local.dev_checks -= 10;	
			return false;
		})
      })
      .on('blur', function() {
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.dev_checks = val;
          sendParams();
        }
        else {
          $(this).val(params.local.dev_checks)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	//allowed deviation from value0

	$('#dev_in_v')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.dev_in_v += 0.01;
			else
				params.local.dev_in_v -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.dev_in_v = val;
          sendParams();
        }
        else {
          $(this).val(params.local.dev_in_v)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	//number of comparison with value0

	$('#timerlimit')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.timerlimit += 1;
			else
				params.local.timerlimit -= 1;	
			return false;
		})
      })
      .on('blur', function() {
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.timerlimit = val;
          sendParams();
        }
        else {
          $(this).val(params.local.timerlimit)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	//number of pulses

	$('#manual_nop')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.manual_nop += 1;
			else
				params.local.manual_nop -= 1;	
			return false;
		})
      })
      .on('blur', function() {
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.manual_nop = val;
          sendParams();
        }
        else {
          $(this).val(params.local.manual_nop)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });


  //patrick - end of code for AO and piezo control

    // Events binding for PID Controller
	
	// Scan function added by Fenske ----------------------------------------------------------------
	$('#scan_11_enable, #scan_22_enable').on('change', function() {
      params.local[this.id] = ($(this).is(':checked') ? 1 : 0);
      sendParams();
    });
	
	// #pid_12_enable and 21 rst deleted by Fenske------------------------------------------------------

    $('#pid_11_enable, #pid_12_enable, #pid_21_enable, #pid_22_enable').on('change', function() { 
      params.local[this.id] = ($(this).is(':checked') ? 1 : 0);
      sendParams();
	//patrick
	var a = document.getElementById("pid11on");
	var b = document.getElementById("pid11off");

	if($('#pid_11_enable').is(':checked') ? 1 : 0 ){
		a.style.display = "block";
		b.style.display = "none";
	}
	else{
		b.style.display = "block";
		a.style.display = "none";
	}
    });
	
	// rst = reset, arst = automatic reset
	
    $('#pid_11_rst, #pid_12_rst, #pid_21_rst, #pid_22_rst').on('change', function() {  
      params.local[this.id] = ($(this).is(':checked') ? 1 : 0);
      sendParams();
    });
	
	$('#pid_11_arst, #pid_12_arst, #pid_21_arst, #pid_22_arst').on('change', function() { 
      params.local[this.id] = ($(this).is(':checked') ? 1 : 0);
      sendParams();
	//patrick
	var f = document.getElementById("arst11on");
	var g = document.getElementById("arst11off");

	if($('#pid_11_arst').is(':checked') ? 1 : 0 ){
		f.style.display = "block";
		g.style.display = "none";
	}
	else{
		g.style.display = "block";
		f.style.display = "none";
	}
    });
	
	
	// PID 11 Gain -------------------------------------------------------- added by Fenske
	$('#pid_11_gain')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_gain').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_gain += 0.01;
			else
				params.local.pid_11_gain -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_gain').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_gain = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_gain)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	  
    // PID 11 Setpoint, Kp, Ki, Kd
    $('#pid_11_sp')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_sp').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_sp += 0.01;
			else
				params.local.pid_11_sp -= 0.01;;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_sp').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_sp = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_sp)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }			
      });

    $('#pid_11_kp')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_kp').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_kp += 0.01;
			else
				params.local.pid_11_kp -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_kp').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_kp = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_kp)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

    $('#pid_11_ki')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_ki').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_ki += 0.5;
			else
				params.local.pid_11_ki -= 0.5;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_ki').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_ki = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_ki)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });

    $('#pid_11_kd')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_kd').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_kd += 0.01;
			else
				params.local.pid_11_kd -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_kd').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_kd = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_kd)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
	  <!--- Button for Limit added by Fenske ------------------->
	  $('#pid_11_limit_up')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_limit_up').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_limit_up += 0.01;
			else
				params.local.pid_11_limit_up -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_limit_up').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_limit_up = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_limit_up)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	  $('#pid_11_limit_low')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_limit_low').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_limit_low += 0.01;
			else
				params.local.pid_11_limit_low -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_limit_low').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_limit_low = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_limit_low)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	  $('#pid_11_int_limit')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_int_limit').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_int_limit += 0.01;
			else
				params.local.pid_11_int_limit -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_int_limit').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_int_limit = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_int_limit)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	  $('#pid_11_kii')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_kii').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_kii += 0.5;
			else
				params.local.pid_11_kii -= 0.5;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_kii').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_kii = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_kii)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
	  $('#pid_11_count_ki')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_11_count_ki').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_11_count_ki += 1;
			else
				params.local.pid_11_count_ki -= 1;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_11_count_ki').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_11_count_ki = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_11_count_ki)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });	  

// PID 12 Gain -------------------------------------------------------- added by Fenske
	$('#pid_12_gain')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_gain').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_gain += 0.01;
			else
				params.local.pid_12_gain -= 0.01;
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_gain').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_gain = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_gain)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
    // PID 12 Setpoint, Kp, Ki, Kd
    $('#pid_12_sp')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_sp').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_sp += 0.01;
			else
				params.local.pid_12_sp -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_sp').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_sp = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_sp)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });

    $('#pid_12_kp')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_kp').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_kp += 0.01;
			else
				params.local.pid_12_kp -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_kp').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_kp = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_kp)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

    $('#pid_12_ki')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_ki').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_ki += 0.5;
			else
				params.local.pid_12_ki -= 0.5;
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_ki').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_ki = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_ki)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });

    $('#pid_12_kd')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_kd').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_kd += 0.01;
			else
				params.local.pid_12_kd -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_kd').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_kd = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_kd)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
	  <!--- Button for Limit added by Fenske ------------------->
	  $('#pid_12_limit_up')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_limit_up').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_limit_up += 0.01;
			else
				params.local.pid_12_limit_up -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_limit_up').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_limit_up = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_limit_up)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	  $('#pid_12_limit_low')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_limit_low').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_limit_low += 0.01;
			else
				params.local.pid_12_limit_low -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_limit_low').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_limit_low = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_limit_low)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	  $('#pid_12_int_limit')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_int_limit').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_int_limit += 0.01;
			else
				params.local.pid_12_int_limit -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_int_limit').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_int_limit = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_int_limit)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	  $('#pid_12_kii')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_kii').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_kii += 0.5;
			else
				params.local.pid_12_kii -= 0.5;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_kii').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_kii = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_kii)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
	$('#pid_12_count_ki')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_12_count_ki').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_12_count_ki += 1;
			else
				params.local.pid_12_count_ki -= 1;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_12_count_ki').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_12_count_ki = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_12_count_ki)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });	  
	  
// PID 21 Gain -------------------------------------------------------- added by Fenske
	$('#pid_21_gain')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_gain').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_gain += 0.01;
			else
				params.local.pid_21_gain -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_gain').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_gain = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_gain)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
    // PID 21 Setpoint, Kp, Ki, Kd
    $('#pid_21_sp')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_sp').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_sp += 0.01;
			else
				params.local.pid_21_sp -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_sp').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_sp = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_sp)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

    $('#pid_21_kp')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_kp').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_kp += 0.01;
			else
				params.local.pid_21_kp -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_kp').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_kp = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_kp)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });

    $('#pid_21_ki')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_ki').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_ki += 0.5;
			else
				params.local.pid_21_ki -= 0.5;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_ki').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_ki = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_ki)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });

    $('#pid_21_kd')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_kd').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_kd += 0.01;
			else
				params.local.pid_21_kd -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_kd').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_kd = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_kd)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
	  <!--- Button for Limit added by Fenske ------------------->
	$('#pid_21_limit_up')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_limit_up').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_limit_up += 0.01;
			else
				params.local.pid_21_limit_up -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_limit_up').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_limit_up = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_limit_up)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	$('#pid_21_limit_low')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_limit_low').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_limit_low += 0.01;
			else
				params.local.pid_21_limit_low -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_limit_low').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_limit_low = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_limit_low)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	$('#pid_21_int_limit')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_int_limit').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_int_limit += 0.01;
			else
				params.local.pid_21_int_limit -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_int_limit').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_int_limit = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_int_limit)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	$('#pid_21_kii')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_kii').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_kii += 0.5;
			else
				params.local.pid_21_kii -= 0.5;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_kii').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_kii = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_kii)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });  
	  
	 $('#pid_21_count_ki')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_21_count_ki').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_21_count_ki += 1;
			else
				params.local.pid_21_count_ki -= 1;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_21_count_ki').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_21_count_ki = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_21_count_ki)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });

	// PID 22 Gain -------------------------- added by Fenske
	$('#pid_22_gain')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_gain').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_gain += 0.01;
			else
				params.local.pid_22_gain -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_22_gain').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_gain = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_gain)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	
    // PID 22 Setpoint, Kp, Ki, Kd
    $('#pid_22_sp')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_sp').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_sp += 0.01;
			else
				params.local.pid_22_sp -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_22_sp').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_sp = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_sp)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });

    $('#pid_22_kp')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_kp').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_kp += 0.01;
			else
				params.local.pid_22_kp -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_22_kp').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_kp = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_kp)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });

    $('#pid_22_ki')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_ki').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_ki += 0.5;
			else
				params.local.pid_22_ki -= 0.5;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_22_ki').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_ki = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_ki)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });

    $('#pid_22_kd')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_kd').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_kd += 0.01;
			else
				params.local.pid_22_kd -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_22_kd').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_kd = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_kd)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
    $('#pid_22_limit_up')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_limit_up').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_limit_up += 0.01;
			else
				params.local.pid_22_limit_up -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_22_limit_up').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_limit_up = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_limit_up)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });

	  $('#pid_22_limit_low')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_limit_low').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_limit_low += 0.01;
			else
				params.local.pid_22_limit_low -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_22_limit_low').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_limit_low = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_limit_low)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	  $('#pid_22_int_limit')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_int_limit').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_int_limit += 0.01;
			else
				params.local.pid_22_int_limit -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_22_int_limit').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_int_limit = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_int_limit)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	$('#pid_22_kii')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_kii').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_kii += 0.5;
			else
				params.local.pid_22_kii -= 0.5;		
			return false;	
	    })
      })
      .on('blur', function() {
        $('#apply_pid_22_kii').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_kii = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_kii)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
	$('#pid_22_count_ki')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_pid_22_count_ki').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.pid_22_count_ki += 1;
			else
				params.local.pid_22_count_ki -= 1;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_pid_22_count_ki').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.pid_22_count_ki = val;
          sendParams();
        }
        else {
          $(this).val(params.local.pid_22_count_ki)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
	  // Buttons added for output offset ---------------------------------- Fenske
	  	// OUT_1_OFFSET -------------------------------------- added by Fenske
	$('#out_1_offset')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_out_1_offset').show();
        $(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.out_1_offset += 0.01;
			else
				params.local.out_1_offset -= 0.01;	
			return false;	
	    })		
      })	
      .on('blur', function() {
        $('#apply_out_1_offset').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.out_1_offset = val;
          sendParams();
        }
        else {
          $(this).val(params.local.out_1_offset)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	  	// OUT_2_OFFSET --------------------------------------- added by Fenske
	$('#out_2_offset')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_out_2_offset').show();	
	    $(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.out_2_offset += 0.01;
			else
				params.local.out_2_offset -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_out_2_offset').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.out_2_offset = val;
          sendParams();
        }
        else {
          $(this).val(params.local.out_2_offset)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }	
      });
	  
	  // MIN_INTENSITY THRESHOLD 1 -------------------------------------------------------- added by Fenske
	  $('#min_i_threshold_1')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_min_i_threshold_1').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.min_i_threshold_1 += 0.01;
			else
				params.local.min_i_threshold_1 -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_min_i_threshold_1').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.min_i_threshold_1 = val;
          sendParams();
        }
        else {
          $(this).val(params.local.min_i_threshold_1)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	  // MIN_INTENSITY THRESHOLD 2 -------------------------------------------------------- added by Fenske
	  $('#min_i_threshold_2')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_min_i_threshold_2').show();
		$(this).bind('mousewheel', function(event, delta) {
			if(delta > 0)
				params.local.min_i_threshold_2 += 0.01;
			else
				params.local.min_i_threshold_2 -= 0.01;	
			return false;
		})
      })
      .on('blur', function() {
        $('#apply_min_i_threshold_2').hide();
        $(this).parent().removeClass('input-group');

        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.min_i_threshold_2 = val;
          sendParams();
        }
        else {
          $(this).val(params.local.min_i_threshold_2)
        }
        user_editing = false;
		$(this).unbind('mousewheel');
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });	  
	  
	  // SAVE_SETTINGS --------------------------------------- added by Fenske
	  $('#save_settings').on('change', function() { onDropdownChange($(this), 'save_settings'); });
	  
	  // LOAD_SETTINGS --------------------------------------- added by Fenske
	  $('#load_settings').on('change', function() { onDropdownChange($(this), 'load_settings'); });
	
	
	// Events binding for signal generator
    
    $('#gen_enable_ch1, #gen_enable_ch2').on('change', function() { 
      params.local[this.id] = ($(this).is(':checked') ? 1 : 0);
      sendParams();
	//patrick
	var f = document.getElementById("ch1on");
	var g = document.getElementById("ch1off");

	if($('#gen_enable_ch1').is(':checked') ? 1 : 0 ){
		f.style.display = "block";
		g.style.display = "none";
	}
	else{
		g.style.display = "block";
		f.style.display = "none";
	}
    });
    
    $('#gen_ch1_sigtype').on('change', function() { onDropdownChange($(this), 'gen_sig_type_ch1'); });
    $('#gen_ch1_trigmode').on('change', function() { onDropdownChange($(this), 'gen_trig_mod_ch1'); });
    $('#gen_ch2_sigtype').on('change', function() { onDropdownChange($(this), 'gen_sig_type_ch2'); });
    $('#gen_ch2_trigmode').on('change', function() { onDropdownChange($(this), 'gen_trig_mod_ch2'); });
    
    $('#gen_ch1_ampl')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_gen_ch1_ampl').show();
      })
      .on('blur', function() {
        $('#apply_gen_ch1_ampl').hide();
        $(this).parent().removeClass('input-group');
        
        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.gen_sig_amp_ch1 = val;
          sendParams();
        }
        else {
          $(this).val(params.local.gen_sig_amp_ch1)
        }
        user_editing = false;
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
      
    $('#gen_ch1_freq')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_gen_ch1_freq').show();
      })
      .on('blur', function() {
        $('#apply_gen_ch1_freq').hide();
        $(this).parent().removeClass('input-group');
        
        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.gen_sig_freq_ch1 = val;
          sendParams();
        }
        else {
          $(this).val(params.local.gen_sig_freq_ch1)
        }
        user_editing = false;
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
      
    $('#gen_ch1_dc')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_gen_ch1_dc').show();
      })
      .on('blur', function() {
        $('#apply_gen_ch1_dc').hide();
        $(this).parent().removeClass('input-group');
        
        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.gen_sig_dcoff_ch1 = val;
          sendParams();
        }
        else {
          $(this).val(params.local.gen_sig_dcoff_ch1)
        }
        user_editing = false;
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
      
    $('#gen_ch2_ampl')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_gen_ch2_ampl').show();
      })
      .on('blur', function() {
        $('#apply_gen_ch2_ampl').hide();
        $(this).parent().removeClass('input-group');
        
        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.gen_sig_amp_ch2 = val;
          sendParams();
        }
        else {
          $(this).val(params.local.gen_sig_amp_ch2)
        }
        user_editing = false;
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
      
    $('#gen_ch2_freq')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_gen_ch2_freq').show();
      })
      .on('blur', function() {
        $('#apply_gen_ch2_freq').hide();
        $(this).parent().removeClass('input-group');
        
        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.gen_sig_freq_ch2 = val;
          sendParams();
        }
        else {
          $(this).val(params.local.gen_sig_freq_ch2)
        }
        user_editing = false;
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
      
    $('#gen_ch2_dc')
      .on('focus paste', function() {
        $(this).parent().addClass('input-group');
        $('#apply_gen_ch2_dc').show();
      })
      .on('blur', function() {
        $('#apply_gen_ch2_dc').hide();
        $(this).parent().removeClass('input-group');
                
        var val = parseLocalFloat($(this).val());
        if(! isNaN(val)) {
          params.local.gen_sig_dcoff_ch2 = val;
          sendParams();
        }
        else {
          $(this).val(params.local.gen_sig_dcoff_ch2)
        }
        user_editing = false;
      })
      .on('change', function() {
        $(this).blur();
      })
      .on('keypress', function(e) {
        if(e.keyCode == 13) {
          $(this).blur();
        }
      });
	  
	  
    // Modals

    $('#modal_err, #modal_app').modal({ show: false, backdrop: 'static', keyboard: false });

    $('#btn_switch_app').on('click', function() {
      var newapp_id = $('#new_app_id').text();
      if(newapp_id.length) {
        location.href = location.href.replace(app_id, newapp_id);
      }
    });

    $('.btn-app-restart').on('click', function() {
      location.reload();
    });

    $('#btn_retry_get').on('click', function() {
      $('#modal_err').modal('hide');
      updateGraphData();
    });

    $('.btn-close-modal').on('click', function() {
      $(this).closest('.modal').modal('hide');
    });

    // Other event bindings

    $('#trigger_tooltip').tooltip({
      title: '',
      trigger: 'manual',
      placement: 'auto left',
      animation: false
    });

    $('.btn').on('click', function() {
      var btn = $(this);
      setTimeout(function() { btn.blur(); }, 10);
    });

    $('#btn_toolbar .btn').on('blur', function() {
      $(this).removeClass('active');
    });

    $(document).on('click', '#accordion > .panel > .panel-heading', function(event) {
      $(this).next('.panel-collapse').collapse('toggle');
      event.stopImmediatePropagation();
    });

    // Tooltips for range buttons
    $('#range_x_minus, #range_x_plus, #range_y_minus, #range_y_plus').tooltip({
      container: 'body'
    });

    // Load first data
    updateGraphData();

    // Stop the application when page is unloaded
    window.onbeforeunload = function() {
      $.ajax({
        url: stop_app_url,
        async: false
      });
    };

  });

  function startApp() {
    $.get(
      start_app_url
    )
    .done(function(dresult) {
      if(dresult.status == 'ERROR') {
        showModalError((dresult.reason ? dresult.reason : 'Could not start the application.'), true);
      }
      else {
        $.post(
          post_url,
          JSON.stringify({ datasets: { params: def_params } })
        )
        .done(function(dresult) {
          app_started = true;
          updateGraphData();
        })
        .fail(function() {
          showModalError('Could not initialize the application with default parameters.', false, true);
        });
      }
    })
    .fail(function() {
      showModalError('Could not start the application.', true);
    });
  }

  function showModalError(err_msg, retry_btn, restart_btn, ignore_btn) {
    var err_modal = $('#modal_err');

    err_modal.find('#btn_retry_get')[retry_btn ? 'show' : 'hide']();
    err_modal.find('.btn-app-restart')[restart_btn ? 'show' : 'hide']();
    err_modal.find('#btn_ignore')[ignore_btn ? 'show' : 'hide']();
    err_modal.find('.modal-body').html(err_msg);
    err_modal.modal('show');
  }

  function updateGraphData() {
    if(downloading) {
      return;
    }
    if(update_timer) {
      clearTimeout(update_timer);
      update_timer = null;
    }
    downloading = true;

    // Send params if there are any unsent changes
    sendParams();

    var arun_before_ajax = autorun;
    var long_timeout_used = use_long_timeout;

    $.ajax({
      url: get_url,
      timeout: (use_long_timeout ? long_timeout : request_timeout),
      cache: false
    })
    .done(function(dresult) {
      last_get_failed = false;

      if(dresult.status === 'ERROR') {
        if(! app_started) {
          startApp();
        }
        else {
          showModalError((dresult.reason ? dresult.reason : 'Application error.'), true, true);
        }
      }
      else if(dresult.datasets !== undefined && dresult.datasets.params !== undefined) {
        // Check if the application started on the server is the same as on client
        if(app_id !== dresult.app.id) {
          if(! app_started) {
            startApp();
          }
          else {
            $('#new_app_id').text(dresult.app.id);
            $('#modal_app').modal('show');
          }
          return;
        }

        app_started = true;

        // Check if trigger mode (which may switch autorun) was changed during ajax request
        var arun_after_ajax = autorun;

        datasets = [];
        for(var i=0; i<dresult.datasets.g1.length; i++) {
          dresult.datasets.g1[i].color = i;
          dresult.datasets.g1[i].label = 'Channel ' + (i+1);
          datasets.push(dresult.datasets.g1[i]);
        }

        if(! plot) {
          initPlot(dresult.datasets.params);
        }
        else {
          // Apply the params state received from server if not in edit mode
          if(! user_editing) {
            loadParams(dresult.datasets.params);

            // Restore the autorun value modified by loadParams
            if(arun_before_ajax != arun_after_ajax) {
              autorun = arun_after_ajax;
            }
          }
          // Time units must be always updated
          else {
            updateTimeUnits(dresult.datasets.params);
          }

          // Force X min/max
          if(dresult.datasets.params.forcex_flag == 1) {
            var options = plot.getOptions();
            options.xaxes[0].min = dresult.datasets.params.xmin;
            options.xaxes[0].max = dresult.datasets.params.xmax;
          }

          // Redraw the plot using new datasets
          plot.setData(filterData(datasets, plot.width()));
          plot.setupGrid();
          plot.draw();
        }

        if(! trig_dragging) {
          updateTriggerSlider();
        }

        updateRanges();

        if(autorun || dresult.status === 'AGAIN') {
          if(autorun) {
            $('#btn_single').prop('disabled', true);
          }
          update_timer = setTimeout(function() {
            updateGraphData();
          }, update_interval);
        }
        else {
          $('#btn_single').prop('disabled', false);
        }
      }
      else {
        showModalError('Wrong application data received.', true, true);
      }
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      if(last_get_failed) {
        showModalError('Data receiving failed.<br>Error status: ' + textStatus, true, true);
        last_get_failed = false;
      }
      else {
        last_get_failed = true;
        downloading = false;
        updateGraphData();  // One more try
      }
    })
    .always(function() {
      if(! last_get_failed) {
        downloading = false;
        if(params.local) {
          // Disable trigger level input if trigger source is External or mode is not Normal
          if(params.original.trig_mode != 1 || params.original.trig_source == 2) {
            $('#trig_level').prop('disabled', true);
            if($('#trig_level').is(':focus')) {
              $('#trig_level').blur();
            }
            $('#apply_trig_level').hide().parent().removeClass('input-group');
          }
          else {
            $('#trig_level').prop('disabled', false);
          }

          // Manage the state of other components
          $('#accordion').find('input,select').not('#trig_level').prop('disabled', false);
          $('.btn').not('#btn_single, #range_y_plus, #range_y_minus, #range_x_plus, #range_x_minus').prop('disabled', false);
        }
      }
      if(long_timeout_used) {
        use_long_timeout = false;
      }

	//patrick laser lock info updates
//	var laserlockon = document.getElementById("LLon")
//	var laserlockoff = document.getElementById("LLoff")
//	var laserlockwaiting = document.getElementById("LLwaiting")
//
//	if(params.local.ll == 0){
//	laserlockon.style.display = "none";
//	laserlockoff.style.display = "block";
//	laserlockwaiting.style.display = "none";
//	}
//	else if(params.local.ll == 1){
//	laserlockon.style.display = "block";
//	laserlockoff.style.display = "none";
//	laserlockwaiting.style.display = "none";
//	}
	

	//patrick end

    });
  }

  function initPlot(init_params) {
    var plot_holder = $('#plot_holder');
    var ymax = init_params.gui_reset_y_range / 2;
    var ymin = ymax * -1;

    // Load received params
    loadParams(init_params);

    // When xmin/xmax are null, the min/max values of received data will be used. For ymin/ymax use the gui_reset_y_range param.
    $.extend(true, plot_options, {
      xaxis: { min: null, max: null },
      yaxis: { min: ymin, max: ymax }
    });

    // Local optimization
    var filtered_data = filterData(datasets, plot_holder.width());

    // Plot first creation and drawing
    plot = $.plot(
      plot_holder,
      filtered_data,
      plot_options
    );

    // Selection
    plot_holder.on('plotselected', function(event, ranges) {

      // Clamp the zooming to prevent eternal zoom
      if(ranges.xaxis.to - ranges.xaxis.from < 0.00001) {
        ranges.xaxis.to = ranges.xaxis.from + 0.00001;
      }
      if(ranges.yaxis.to - ranges.yaxis.from < 0.00001) {
        ranges.yaxis.to = ranges.yaxis.from + 0.00001;
      }

      // Do the zooming
      plot = $.plot(
        plot_holder,
        getData(ranges.xaxis.from, ranges.xaxis.to),
        $.extend(true, plot_options, {
          xaxis: { min: ranges.xaxis.from, max: ranges.xaxis.to },
          yaxis: { min: ranges.yaxis.from, max: ranges.yaxis.to }
        })
      );

      params.local.xmin = parseFloat(ranges.xaxis.from.toFixed(xdecimal_places));
      params.local.xmax = parseFloat(ranges.xaxis.to.toFixed(xdecimal_places));

      updateTriggerSlider();
      sendParams(true);
    });

    // Zoom / Pan
    plot_holder.on('plotzoom plotpan touchmove touchend', function(event) {

      if(zoompan_timer) {
        clearTimeout(zoompan_timer);
        zoompan_timer = null;
      }

      zoompan_timer = setTimeout(function() {
        zoompan_timer = null;

        var xaxis = plot.getAxes().xaxis;
        params.local.xmin = parseFloat(xaxis.min.toFixed(xdecimal_places));
        params.local.xmax = parseFloat(xaxis.max.toFixed(xdecimal_places));

        updateTriggerSlider();
        sendParams(true);

      }, 250);
    });
  }

  function onDropdownChange(that, param_name, do_get) {
    params.local[param_name] = parseInt(that.val());
    sendParams(do_get);
    that.blur();
    user_editing = false;
  }

  function loadParams(orig_params) {
    if(! $.isPlainObject(orig_params)) {
      return;
    }

    // Ignore xmin/xmax values received from server. That values must be used only on AUTO button click
    // and on ForceX flag, but that is done before the sendParams() function is called.
    if(plot) {
      var options = plot.getOptions();
      if(options.xaxes[0].min && options.xaxes[0].max) {
        orig_params.xmin = options.xaxes[0].min;
        orig_params.xmax = options.xaxes[0].max;
      }
    }

    // Same data in local and original params
    params.original = $.extend({}, orig_params);
    params.local = $.extend({}, params.original);

    // Autorun if trigger mode is Auto(0) or Normal(1), stop if it is Single(2)
    autorun = (params.original.trig_mode == 2 ? 0 : 1);

    // Enable the Single button when not in autorun mode
    $('#btn_single').prop('disabled', autorun);

    $('#trig_mode').val(params.original.trig_mode);
    $('#trig_source').val(params.original.trig_source);
    $('#trig_edge').val(params.original.trig_edge);
    $('#trig_level').val(floatToLocalString(params.original.trig_level));
	
	
	
 <!--- bar graph to visualize the output-parts : fist initialisation of the variables Fenske ------------->

var info_ch1_p = shortenFloat(params.original.meas_p_ch1);
var info_ch1_i = shortenFloat(params.original.meas_i_ch1);
var info_ch1_d = shortenFloat(params.original.meas_d_ch1);
var info_ch1_o = shortenFloat(params.original.meas_o_ch1);

var info_ch2_p = shortenFloat(params.original.meas_p_ch2);
var info_ch2_i = shortenFloat(params.original.meas_i_ch2);
var info_ch2_d = shortenFloat(params.original.meas_d_ch2);
var info_ch2_o = shortenFloat(params.original.meas_o_ch2);

var info_ch1_p_pos = 0;	
var info_ch1_i_pos = 0;
var info_ch1_d_pos = 0;
var info_ch1_o_pos = 0;

var info_ch1_p_neg = 0;	
var info_ch1_i_neg = 0;
var info_ch1_d_neg = 0;
var info_ch1_o_neg = 0;

var info_ch2_p_pos = 0;	
var info_ch2_i_pos = 0;
var info_ch2_d_pos = 0;
var info_ch2_o_pos = 0;

var info_ch2_p_neg = 0;	
var info_ch2_i_neg = 0;
var info_ch2_d_neg = 0;
var info_ch2_o_neg = 0;

<!--- ------------------------------------------------------------>	
	
    if ((refresh_counter++ % meas_panel_dec) == 0) {
        $('#info_ch1_min').html(floatToLocalString(shortenFloat(params.original.meas_min_ch1)));
	$('#info_ll').html(floatToLocalInt(params.original.ll));				//patrick
	$('#info_value0').html(floatToLocalString(shortenFloat(params.original.value0)));
	$('#info_ll_timer').html(floatToLocalInt(params.original.ll_timer));
	$('#info_laser_lock_value').html(floatToLocalInt(params.original.laser_lock_value));
	$('#info_pulse_timer').html(floatToLocalString(shortenFloat(params.original.pulse_timer)));
	$('#info_manual_nop').html(floatToLocalInt(params.original.manual_nop));
	$('#info_pid_11_enable').html(floatToLocalString(shortenFloat(params.original.pid_11_enable)));
	$('#info_pid_11_arst').html(floatToLocalString(shortenFloat(params.original.pid_11_arst)));
	$('#info_gen_enable_ch1').html(floatToLocalString(shortenFloat(params.original.gen_enable_ch1)));
	$('#info_piezo_manual').html(floatToLocalString(shortenFloat(params.original.piezo_manual)));
	$('#info_min_i_threshold_1').html(floatToLocalString(shortenFloat(params.original.min_i_threshold_1)));
	$('#info_piezo_enable').html(floatToLocalString(shortenFloat(params.original.piezo_enable)));
	$('#info_timerlimit').html(floatToLocalInt(params.original.timerlimit));		//patrick - end
	
        $('#info_ch1_max').html(floatToLocalString(shortenFloat(params.original.meas_max_ch1)));
        $('#info_ch1_amp').html(floatToLocalString(shortenFloat(params.original.meas_amp_ch1)));
        $('#info_ch1_avg').html(floatToLocalString(shortenFloat(params.original.meas_avg_ch1)));
        $('#info_ch1_freq').html(convertHz(params.original.meas_freq_ch1));
        $('#info_ch1_period').html(convertSec(params.original.meas_per_ch1));
		
		// Fenske------------------------------------------------------------------------------------------------- bar graph
		$('#info_ch1_p').html(floatToLocalString(shortenFloat(params.original.meas_p_ch1)));
		$('#info_ch1_i').html(floatToLocalString(shortenFloat(params.original.meas_i_ch1)));
		$('#info_ch1_d').html(floatToLocalString(shortenFloat(params.original.meas_d_ch1)));
		$('#info_ch1_o').html(floatToLocalString(shortenFloat(params.original.meas_o_ch1)));
		$('#info_min_intens_1').html(floatToLocalString(shortenFloat(params.original.min_intens_1)));

        $('#info_ch2_min').html(floatToLocalString(shortenFloat(params.original.meas_min_ch2)));
        $('#info_ch2_max').html(floatToLocalString(shortenFloat(params.original.meas_max_ch2)));
        $('#info_ch2_amp').html(floatToLocalString(shortenFloat(params.original.meas_amp_ch2)));
        $('#info_ch2_avg').html(floatToLocalString(shortenFloat(params.original.meas_avg_ch2)));
        $('#info_ch2_freq').html(convertHz(params.original.meas_freq_ch2));
        $('#info_ch2_period').html(convertSec(params.original.meas_per_ch2));
		$('#info_min_intens_2').html(floatToLocalString(shortenFloat(params.original.min_intens_2)));
		
		// Fenske------------------------------------------------------------------------------------------------- bar graph
		$('#info_ch2_p').html(floatToLocalString(shortenFloat(params.original.meas_p_ch2)));
		$('#info_ch2_i').html(floatToLocalString(shortenFloat(params.original.meas_i_ch2)));
		$('#info_ch2_d').html(floatToLocalString(shortenFloat(params.original.meas_d_ch2)));
		$('#info_ch2_o').html(floatToLocalString(shortenFloat(params.original.meas_o_ch2)));
		
		$('#rot_encoder').html(floatToLocalString(shortenFloat(params.original.rot_encoder)));
 
	    <!--- bar graph to visualize the output-parts Fenske ------------->

		info_ch1_p = shortenFloat(params.original.meas_p_ch1);
		info_ch1_i = shortenFloat(params.original.meas_i_ch1);
		info_ch1_d = shortenFloat(params.original.meas_d_ch1);
		info_ch1_o = shortenFloat(params.original.meas_o_ch1);

		info_ch2_p = shortenFloat(params.original.meas_p_ch2);
		info_ch2_i = shortenFloat(params.original.meas_i_ch2);
		info_ch2_d = shortenFloat(params.original.meas_d_ch2);
		info_ch2_o = shortenFloat(params.original.meas_o_ch2);
		
		<!--- bar graph channel1 test if value pos or neg Fenske ------------->
		if (info_ch1_p > 0){
			info_ch1_p_pos = info_ch1_p;
			info_ch1_p_neg = 0;
		}
		else{
			info_ch1_p_pos = 0;
			info_ch1_p_neg = (-info_ch1_p);
		}
		
		if (info_ch1_i > 0){
			info_ch1_i_pos = info_ch1_i;
			info_ch1_i_neg = 0;
		}
		else{
			info_ch1_i_pos = 0;
			info_ch1_i_neg = (-info_ch1_i);
		}
		
		if (info_ch1_d > 0){
			info_ch1_d_pos = info_ch1_d;
			info_ch1_d_neg = 0;
		}
		else{
			info_ch1_d_pos = 0;
			info_ch1_d_neg = (-info_ch1_d);
		}
		
		if (info_ch1_o > 0){
			info_ch1_o_pos = info_ch1_o;
			info_ch1_o_neg = 0;
		}
		else{
			info_ch1_o_pos = 0;
			info_ch1_o_neg = (-info_ch1_o);
		}

		<!--- bar graph channel2 test if value pos or neg Fenske ------------->
		if (info_ch2_p > 0){
			info_ch2_p_pos = info_ch2_p;
			info_ch2_p_neg = 0;
		}
		else{
			info_ch2_p_pos = 0;
			info_ch2_p_neg = (-info_ch2_p);
		}
		
		if (info_ch2_i > 0){
			info_ch2_i_pos = info_ch2_i;
			info_ch2_i_neg = 0;
		}
		else{
			info_ch2_i_pos = 0;
			info_ch2_i_neg = (-info_ch2_i);
		}
		
		if (info_ch2_d > 0){
			info_ch2_d_pos = info_ch2_d;
			info_ch2_d_neg = 0;
		}
		else{
			info_ch2_d_pos = 0;
			info_ch2_d_neg = (-info_ch2_d);
		}
		
		if (info_ch2_o > 0){
			info_ch2_o_pos = info_ch2_o;
			info_ch2_o_neg = 0;
		}
		else{
			info_ch2_o_pos = 0;
			info_ch2_o_neg = (-info_ch2_o);
		}

		graphByPID_ch1 = new Array(
			[1,'Max'],
			[info_ch1_p_pos,'P'],
			[info_ch1_i_pos,'I'],
			[info_ch1_d_pos,'D'],
			[info_ch1_o_pos,'Output']	
		);
		
		graphByPID_ch1_neg = new Array(
			[1,'Min'],
			[info_ch1_p_neg,'P'],
			[info_ch1_i_neg,'I'],
			[info_ch1_d_neg,'D'],
			[info_ch1_o_neg,'Output']	
		);
	
		graphByPID_ch2 = new Array(
			[1,'Max'],
			[info_ch2_p_pos,'P'],
			[info_ch2_i_pos,'I'],
			[info_ch2_d_pos,'D'],
			[info_ch2_o_pos,'Output']	
		);
		
		graphByPID_ch2_neg = new Array(
			[1,'Max'],
			[info_ch2_p_neg,'P'],
			[info_ch2_i_neg,'I'],
			[info_ch2_d_neg,'D'],
			[info_ch2_o_neg,'Output']	
		);		
		
	
		$('#outputGraph_ch1').html('');  // clear space to redraw graph
		$('#outputGraph_ch1').jqBarGraph({
			data: graphByPID_ch1,
			width: 300,
			height: 120,
			colors: ['#0000CD','#CD8500','#7D252B','#6E8B3D','#1B3E69'],
			color: '#1A2944',
			barSpace: 5,
			postfix: 'V',
			speed: 0
			//title: '<h2>P-, I-, D-, Output</h2>' // <br /><small>simple bar graph</small></h3>'
		});
		
		$('#outputGraph_ch1_neg').html('');
		$("#outputGraph_ch1_neg").jqBarGraph({
			data: graphByPID_ch1_neg,
			width: 300,
			height: 120,
			position: 'top',
			colors: ['#0000CD','#CD8500','#7D252B','#6E8B3D','#1B3E69'],
			color: '#1A2944',
			barSpace: 5,
			prefix: '-', 
			postfix: 'V',
			speed: 0
			//legend: true
		});
		
		$('#outputGraph_ch2').html('');  // clear space to redraw graph
		$('#outputGraph_ch2').jqBarGraph({
			data: graphByPID_ch2,
			width: 300,
			height: 120,
			colors: ['#0000CD','#CD8500','#7D252B','#6E8B3D','#1B3E69'],
			color: '#1A2944',
			barSpace: 5,
			postfix: 'V',
			speed: 0
			//title: '<h2>P-, I-, D-, Output</h2>' // <br /><small>simple bar graph</small></h3>'
		});
		
		$('#outputGraph_ch2_neg').html('');
		$("#outputGraph_ch2_neg").jqBarGraph({
			data: graphByPID_ch2_neg,
			width: 300,
			height: 120,
			position: 'top',
			colors: ['#0000CD','#CD8500','#7D252B','#6E8B3D','#1B3E69'],
			color: '#1A2944',
			barSpace: 5,
			prefix: '-', 
			postfix: 'V',
			speed: 0
			//legend: true
		});		
		
	
}

//patrick - getting values from backend

	$('#AO_enable_pin0').prop('checked', (params.original.AO_enable_pin0 ? true : false));
	$('#AO_enable_pin1').prop('checked', (params.original.AO_enable_pin1 ? true : false));
	$('#AO_enable_pin2').prop('checked', (params.original.AO_enable_pin2 ? true : false));
	$('#AO_enable_pin3').prop('checked', (params.original.AO_enable_pin3 ? true : false));
	$('#piezo_enable').prop('checked', (params.original.piezo_enable ? true : false));
	$('#piezo_manual').prop('checked', (params.original.piezo_manual ? true : false));
	$('#manual_dir').prop('checked', (params.original.manual_dir ? true : false));
	$('#manual_go').prop('checked', (params.original.manual_go ? true : false));
	$('#slow_pulses').prop('checked', (params.original.slow_pulses ? true : false));	

	$('#manual_nop').val(params.original.manual_nop);
	$('#pulse_len').val(params.original.pulse_len);
	$('#AO_trsh_up').val(params.original.AO_trsh_up);
	$('#AO_trsh_down').val(params.original.AO_trsh_down);
	$('#dev_checks').val(params.original.dev_checks);
	$('#dev_in_v').val(params.original.dev_in_v);		//allowed deviation
	$('#timerlimit').val(params.original.timerlimit);		//reset value

//patrick - updating piezo status and ll status

	var propu = params.original.prod_pulse;
	var pien = params.original.piezo_enable;
	var mango = params.original.manual_go;
	var x = document.getElementById("piezogo");
	var y = document.getElementById("piezogosoon");
	var z = document.getElementById("piezono");
	var w = document.getElementById("LLwaiting");
	var laserlockon = document.getElementById("LLon")
	var laserlockoff = document.getElementById("LLoff")

	if(pien == 1){
		if(propu == 1){
		x.style.display = "block";
		y.style.display = "none";
		z.style.display = "none";
		}
		else if(mango == 1){
		x.style.display = "block";
		y.style.display = "none";
		z.style.display = "none";
		}
		else{
		x.style.display = "none";
		y.style.display = "none";
		z.style.display = "block";
		}
		if(params.local.ll == 0){
		laserlockon.style.display = "none";
		laserlockoff.style.display = "block";
		w.style.display = "none";
		}
		else if(params.local.ll == 1){
		laserlockon.style.display = "block";
		laserlockoff.style.display = "none";
		w.style.display = "none";
		}
	}
	else{
		if(mango == 1){
		x.style.display = "none";
		y.style.display = "block";
		z.style.display = "none";
		}
		w.style.display = "block";
		laserlockon.style.display = "none";
		laserlockoff.style.display = "none";
	}

<!--- ------------------------------------------------------------>	



    $('#gain_ch1_att').val(params.original.prb_att_ch1);
    $('#gain_ch1_sett').val(params.original.gain_ch1);
    $('#gain_ch2_att').val(params.original.prb_att_ch2);
    $('#gain_ch2_sett').val(params.original.gain_ch2);
	
<!---Fenske ------------------------------------------------------------------------------------------------------------------------------->	
	$('#scan_11_enable').prop('checked', (params.original.scan_11_enable ? true : false));
    $('#scan_22_enable').prop('checked', (params.original.scan_22_enable ? true : false));

<!---Fenske Generator !!!!!!--------------------------------------------------------------------------------------------------------->	
	$('#gen_enable_ch1').prop('checked', (params.original.gen_enable_ch1 ? true : false));
    $('#gen_enable_ch2').prop('checked', (params.original.gen_enable_ch2 ? true : false));
    
    $('#gen_ch1_sigtype').val(params.original.gen_sig_type_ch1);
    $('#gen_ch1_ampl').val(floatToLocalString(params.original.gen_sig_amp_ch1));
    $('#gen_ch1_freq').val(floatToLocalString(params.original.gen_sig_freq_ch1));
    $('#gen_ch1_dc').val(floatToLocalString(params.original.gen_sig_dcoff_ch1));
    $('#gen_ch1_trigmode').val(params.original.gen_trig_mod_ch1);
    
    $('#gen_ch2_sigtype').val(params.original.gen_sig_type_ch2);
    $('#gen_ch2_ampl').val(floatToLocalString(params.original.gen_sig_amp_ch2));
    $('#gen_ch2_freq').val(floatToLocalString(params.original.gen_sig_freq_ch2));
    $('#gen_ch2_dc').val(floatToLocalString(params.original.gen_sig_dcoff_ch2));
    $('#gen_ch2_trigmode').val(params.original.gen_trig_mod_ch2);
    
    $('#gen_ch1_single').prop('disabled', (params.original.gen_trig_mod_ch1 == 1 ? false : true));
    $('#gen_ch2_single').prop('disabled', (params.original.gen_trig_mod_ch2 == 1 ? false : true)); 
<!---Fenske Generator END !!!!!!--------------------------------------------------------------------------------------------------------->	

    $('#pid_11_enable').prop('checked', (params.original.pid_11_enable ? true : false));
	$('#pid_12_enable').prop('checked', (params.original.pid_12_enable ? true : false));
	$('#pid_21_enable').prop('checked', (params.original.pid_21_enable ? true : false));
    $('#pid_22_enable').prop('checked', (params.original.pid_22_enable ? true : false));

    $('#pid_11_rst').prop('checked', (params.original.pid_11_rst ? true : false));
	$('#pid_12_rst').prop('checked', (params.original.pid_12_rst ? true : false));
	$('#pid_21_rst').prop('checked', (params.original.pid_21_rst ? true : false));
    $('#pid_22_rst').prop('checked', (params.original.pid_22_rst ? true : false));
<!---Fenske ------------------------------------------------------------------------------------------------------------------------------->	
	$('#pid_11_arst').prop('checked', (params.original.pid_11_arst ? true : false));
	$('#pid_12_arst').prop('checked', (params.original.pid_12_arst ? true : false));
	$('#pid_21_arst').prop('checked', (params.original.pid_21_arst ? true : false));
	$('#pid_22_arst').prop('checked', (params.original.pid_22_arst ? true : false));

	$('#pid_11_gain').val(params.original.pid_11_gain); <!--- Fenske -->
    $('#pid_11_sp').val(params.original.pid_11_sp);
    $('#pid_11_kp').val(params.original.pid_11_kp);
    $('#pid_11_ki').val(params.original.pid_11_ki);
    $('#pid_11_kd').val(params.original.pid_11_kd);
	$('#pid_11_limit_up').val(params.original.pid_11_limit_up); <!--- Fenske -->
	$('#pid_11_limit_low').val(params.original.pid_11_limit_low); <!--- Fenske -->
	$('#pid_11_int_limit').val(params.original.pid_11_int_limit); <!--- Fenske -->
	$('#pid_11_kii').val(params.original.pid_11_kii); <!--- Fenske -->
	$('#pid_11_count_ki').val(params.original.pid_11_count_ki); <!--- Fenske -->
	
	$('#pid_12_gain').val(params.original.pid_12_gain); <!--- Fenske -->
    $('#pid_12_sp').val(params.original.pid_12_sp);
    $('#pid_12_kp').val(params.original.pid_12_kp);
    $('#pid_12_ki').val(params.original.pid_12_ki);
    $('#pid_12_kd').val(params.original.pid_12_kd);
	$('#pid_12_limit_up').val(params.original.pid_12_limit_up); <!--- Fenske -->
	$('#pid_12_limit_low').val(params.original.pid_12_limit_low); <!--- Fenske -->	
	$('#pid_12_int_limit').val(params.original.pid_12_int_limit); <!--- Fenske -->
	$('#pid_12_kii').val(params.original.pid_12_kii); <!--- Fenske -->
	$('#pid_12_count_ki').val(params.original.pid_12_count_ki); <!--- Fenske -->
	
	$('#pid_21_gain').val(params.original.pid_21_gain); <!--- Fenske -->
    $('#pid_21_sp').val(params.original.pid_21_sp);
    $('#pid_21_kp').val(params.original.pid_21_kp);
    $('#pid_21_ki').val(params.original.pid_21_ki);
    $('#pid_21_kd').val(params.original.pid_21_kd);
	$('#pid_21_limit_up').val(params.original.pid_21_limit_up); <!--- Fenske -->
	$('#pid_21_limit_low').val(params.original.pid_21_limit_low); <!--- Fenske --> 
	$('#pid_21_int_limit').val(params.original.pid_21_int_limit); <!--- Fenske --> 
	$('#pid_21_kii').val(params.original.pid_21_kii); <!--- Fenske -->
	$('#pid_21_count_ki').val(params.original.pid_21_count_ki); <!--- Fenske -->

	$('#pid_22_gain').val(params.original.pid_22_gain); <!--- Fenske -->
    $('#pid_22_sp').val(params.original.pid_22_sp);
    $('#pid_22_kp').val(params.original.pid_22_kp);
    $('#pid_22_ki').val(params.original.pid_22_ki);
    $('#pid_22_kd').val(params.original.pid_22_kd);
	$('#pid_22_limit_up').val(params.original.pid_22_limit_up); <!--- Fenske -->
	$('#pid_22_limit_low').val(params.original.pid_22_limit_low); <!--- Fenske -->
	$('#pid_22_int_limit').val(params.original.pid_22_int_limit); <!--- Fenske -->
	$('#pid_22_kii').val(params.original.pid_22_kii); <!--- Fenske -->
	$('#pid_22_count_ki').val(params.original.pid_22_count_ki); <!--- Fenske -->
	
	$('#out_1_offset').val(params.original.out_1_offset); <!--- Fenske -->
	$('#out_2_offset').val(params.original.out_2_offset); <!--- Fenske -->
	
	$('#min_i_threshold_1').val(params.original.min_i_threshold_1); <!--- Fenske -->
	$('#min_i_threshold_2').val(params.original.min_i_threshold_2); <!--- Fenske -->
	
	$('#save_settings').val(params.original.save_settings); <!--- Fenske -->
	$('#load_settings').val(params.original.load_settings); <!--- Fenske -->

    if(params.original.en_avg_at_dec) {
      $('#btn_avg').removeClass('btn-default').addClass('btn-primary');
    }
    else {
      $('#btn_avg').removeClass('btn-primary').addClass('btn-default');
    }

    updateTimeUnits(orig_params);
    $('#ytitle').show();
  }

  function updateTimeUnits(new_params) {
    if(! $.isPlainObject(new_params)) {
      return;
    }

    params.original.time_units = params.local.time_units = new_params.time_units;

    var timeu_lbl = (params.original.time_units == 0 ? 's' : (params.original.time_units == 1 ? 'ms' : 's'));
    $('#xtitle').text('Time [ ' + timeu_lbl + ' ]');
  }

  function isParamChanged() {
    if(params.original) {
      for(var key in params.original) {
        if(params.original[key] != params.local[key]) {
          return true;
        }
      }
    }
    return false;
  }

  function sendParams(refresh_data, force_send, single_btn) {
    if(sending || (force_send !== true && !isParamChanged())) {
      send_que = sending;
      return;
    }

    var auto_flag = params.local.auto_flag;  // Keep the value of auto_flag, because in POST response it is always 0
    sending = true;
    params.local.single_btn = (single_btn === true ? 1 : 0);
    use_long_timeout = !!auto_flag;

    $.ajax({
      type: 'POST',
      url: post_url,
      data: JSON.stringify({ datasets: { params: params.local } }),
      timeout: (use_long_timeout ? long_timeout : request_timeout),
      cache: false
    })
    .done(function(dresult) {
      // OK: Load the params received as POST result
      if(dresult.datasets !== undefined && dresult.datasets.params !== undefined) {

        // Use the provided min/max values only once after AUTO button was clicked
        if(auto_flag == 1 && dresult.datasets.params.min_y !== dresult.datasets.params.max_y) {
          var options = plot.getOptions();

          options.xaxes[0].min = dresult.datasets.params.xmin;
          options.xaxes[0].max = dresult.datasets.params.xmax;
          options.yaxes[0].min = dresult.datasets.params.min_y;
          options.yaxes[0].max = dresult.datasets.params.max_y;

          // Enable both channels after click on AUTO button
          if(!$('#btn_ch1').data('checked') || !$('#btn_ch2').data('checked')) {
            $('#btn_ch1').data('checked', true).removeClass('btn-default').addClass('btn-primary');
            $('#btn_ch2').data('checked', true).removeClass('btn-default').addClass('btn-primary');
            redrawPlot();
          }
          // Both channels are already active, do a quick redraw
          else {
            plot.setupGrid();
            plot.draw();
          }
        }

        if(auto_flag == 0 && dresult.datasets.params.forcex_flag == 1) {
          var options = plot.getOptions();

          options.xaxes[0].min = dresult.datasets.params.xmin;
          options.xaxes[0].max = dresult.datasets.params.xmax;

          plot.setupGrid();
          plot.draw();
        }

        loadParams(dresult.datasets.params);
        updateTriggerSlider();

        if(refresh_data && !downloading) {
          updateGraphData();
        }
      }
      else if(dresult.status == 'ERROR') {
        showModalError((dresult.reason ? dresult.reason : 'Error while sending data (E1).'), false, true, true);
        send_que = false;
      }
      else {
        showModalError('Error while sending data (E2).', false, true, true);
      }
    })
    .fail(function() {
      showModalError('Error while sending data (E3).', false, true, true);
    })
    .always(function() {
      sending = false;
      user_editing = false;

      if(send_que) {
        send_que = false;
        setTimeout(function(refresh_data) {
          sendParams(refresh_data);
        }, 100);
      }
    });
  }

  function getData(from, to) {
    var rangedata = new Array();
    for(var i=0; i<datasets.length; i++) {
      if(! $('#btn_ch' + (i+1)).data('checked')) {
        continue;
      }
      rangedata.push({ color: datasets[i].color, label: datasets[i].label, data: [] });
      for(var j=0; j<datasets[i].data.length; j++) {
        if(datasets[i].data[j][0] > to) {
          break;
        }
        if(datasets[i].data[j][0] >= from) {
          rangedata[rangedata.length - 1].data.push(datasets[i].data[j]);
        }
      }
    }
    rangedata = filterData(rangedata, (plot ? plot.width() : $('plot_holder').width()));
    return rangedata;
  }

  // Use only data for selected channels and do downsamling (data decimation), which is required for
  // better performance. On the canvas cannot be shown too much graph points.
  function filterData(dsets, points) {
    var filtered = [];
    var num_of_channels = 2; 

    for(var l=0; l<num_of_channels; l++) {
      if(! $('#btn_ch' + (l+1)).data('checked')) {
        continue;
      }

      i = Math.min(l, dsets.length - 1);

      filtered.push({ color: dsets[i].color, label: dsets[i].label, data: [] });

      if(points_per_px === null || dsets[i].data.length > points * points_per_px) {
        var step = Math.ceil(dsets[i].data.length / (points * points_per_px));
        var k = 0;
        for(var j=0; j<dsets[i].data.length; j++) {
          if(k > 0 && ++k < step) {
            continue;
          }
          filtered[filtered.length - 1].data.push(dsets[i].data[j]);
          k = 1;
        }
      }
      else {
        filtered[filtered.length - 1].data = dsets[i].data.slice(0);
      }
    }

    filtered = addTriggerDataSet(filtered);
    return filtered;
  }

  // Add a data series for the trigger level line
  function addTriggerDataSet(dsets) {

    // Don't add trigger dataset if trigger level is outside the visible area...
    if(plot) {
      var yaxis = plot.getAxes().yaxis;
      if(params.local.trig_level < yaxis.min || params.local.trig_level > yaxis.max) {
        return dsets;
      }
    }
    // ...or trigger mode is not Normal
    if(params.local.trig_mode != 1) {
      return dsets;
    }
    // ...or trigger source is external
    if(params.local.trig_source == 2) {
      return dsets;
    }
    // ...or outside of received data for Y axis
    var ch1ymin = null,
        ch1ymax = null;
    // Find Y min/max values from data for first visible channel
    for(var i=0; i<dsets[0].data.length; i++) {
      ch1ymin = (ch1ymin === null || ch1ymin > dsets[0].data[i][1] ? dsets[0].data[i][1] : ch1ymin);
      ch1ymax = (ch1ymax === null || ch1ymax < dsets[0].data[i][1] ? dsets[0].data[i][1] : ch1ymax);
    }
    if(dsets.length > 1) {
      var ch2ymin = null,
          ch2ymax = null;
      // Find Y min/max values from data for second visible channel
      for(var i=0; i<dsets[1].data.length; i++) {
        ch2ymin = (ch2ymin === null || ch2ymin > dsets[1].data[i][1] ? dsets[1].data[i][1] : ch2ymin);
        ch2ymax = (ch2ymax === null || ch2ymax < dsets[1].data[i][1] ? dsets[1].data[i][1] : ch2ymax);
      }
      // Check if trigger level is outside of found values
      if(params.local.trig_level < Math.min(ch1ymin, ch2ymin) || params.local.trig_level > Math.max(ch1ymax, ch2ymax)) {
        return dsets;
      }
    }
    else {
      // Check if trigger level is outside of found values
      if(params.local.trig_level < ch1ymin || params.local.trig_level > ch1ymax) {
        return dsets;
      }
    }

    var index = 0;
    var dxmin = 0;
    var dxmax = 1;

    if(dsets.length && dsets[0].data[0]) {
      index = dsets.length;

      dxmin = dsets[0].data[0][0];
      dxmax = dsets[0].data[dsets[0].data.length - 1][0];
    }
    dsets[index] = { color: 2, data: [[dxmin, params.local.trig_level], [dxmax, params.local.trig_level]], shadowSize: 1 };

    return dsets;
  }

  function runStop() {
    if(autorun) {
      $('#btn_single').prop('disabled', true);
      updateGraphData();
    }
    else {
      $('#btn_single').prop('disabled', false);
      if(update_timer) {
        clearTimeout(update_timer);
        update_timer = null;
      }
    }
  }

  function singleUpdate() {
    if(! autorun) {
      sendParams(true, true, true);
    }
  }

  function redrawPlot() {
    if(! downloading) {
      if(! plot) {
        updateGraphData();
      }
      else {
        var options = plot.getOptions();
        plot = $.plot(
          plot.getPlaceholder(),
          filterData(datasets, plot.width()),
          $.extend(true, plot_options, {
            xaxis: { min: options.xaxes[0].min, max: options.xaxes[0].max },
            yaxis: { min: options.yaxes[0].min, max: options.yaxes[0].max }
          })
        );
        updateTriggerSlider();
      }
    }
  }

  function setVisibleChannels(btn) {
    var other_btn = $(btn.id == 'btn_ch1' ? '#btn_ch2' : '#btn_ch1');
    var btn = $(btn);
    var checked = !btn.data('checked');

    btn.data('checked', checked).toggleClass('btn-default btn-primary');

    // At least one button must be checked, so that at least one graph will be visible.
    if(! checked) {
      other_btn.data('checked', true).removeClass('btn-default').addClass('btn-primary');
    }
    redrawPlot();
  }

  function autoscaleY() {
    if(! plot) {
      return;
    }

    var options = plot.getOptions();
    var axes = plot.getAxes();

    // Set Y scale to data min/max + 10%
    options.yaxes[0].min = (axes.yaxis.datamin < 0 ? axes.yaxis.datamin * 1.1 : axes.yaxis.datamin - axes.yaxis.datamin * 0.1);
    options.yaxes[0].max = (axes.yaxis.datamax > 0 ? axes.yaxis.datamax * 1.1 : axes.yaxis.datamax + axes.yaxis.datamax * 0.1);

    plot.setupGrid();
    plot.draw();

    updateRanges();
    updateTriggerSlider();
  }

  function setAvgAtDec() {
    if(! plot) {
      return;
    }

    $('#btn_avg').toggleClass('btn-default btn-primary');

    if($('#btn_avg').hasClass('btn-primary')) {
      params.local.en_avg_at_dec = 1;
    }
    else{
      params.local.en_avg_at_dec = 0;
    }

    sendParams(true, true);
  }

  function resetZoom() {
    if(! plot) {
      return;
    }

    $('#btn_ch1, #btn_ch2').data('checked', true).removeClass('btn-default').addClass('btn-primary');

    var ymax = params.original.gui_reset_y_range / 2;
    var ymin = ymax * -1;

    $.extend(true, plot_options, {
      xaxis: { min: null, max: null },
      yaxis: { min: ymin, max: ymax }
    });

    var options = plot.getOptions();
    options.xaxes[0].min = null;
    options.xaxes[0].max = null;
    options.yaxes[0].min = ymin;
    options.yaxes[0].max = ymax;

    plot.setupGrid();
    plot.draw();

    params.local.xmin = xmin;
    params.local.xmax = xmax;

    sendParams(true, true);
  }

  function updateZoom() {
    if(! plot) {
      return;
    }

    params.local.xmin = 0;
    params.local.xmax = time_range_max[params.local.time_range];

    var axes = plot.getAxes();
    var options = plot.getOptions();

    options.xaxes[0].min = params.local.xmin;
    options.xaxes[0].max = params.local.xmax;
    options.yaxes[0].min = axes.yaxis.min;
    options.yaxes[0].max = axes.yaxis.max;

    plot.setupGrid();
    plot.draw();

    sendParams(true, true);
  }

  function selectTool(toolname) {
    $('#selzoompan .btn').removeClass('btn-primary').addClass('btn-default');
    $(this).toggleClass('btn-default btn-primary');

    if(toolname == 'zoomin') {
      enableZoomInSelection();
    }
    if(toolname == 'zoomout') {
      enableZoomOut();
    }
    else if(toolname == 'pan') {
      enablePanning();
    }
  }

  function enableZoomInSelection() {
    if(plot_options.hasOwnProperty('selection')) {
      return;
    }

    var plot_pholder = plot.getPlaceholder();

    // Disable panning and zoom out
    delete plot_options.pan;
    plot_pholder.off('click.rp');

    // Get current min/max for both axes to use them to fix the current view
    var axes = plot.getAxes();

    plot = $.plot(
      plot_pholder,
      plot.getData(),
      $.extend(true, plot_options, {
        selection: { mode: 'xy' },
        xaxis: { min: axes.xaxis.min, max: axes.xaxis.max },
        yaxis: { min: axes.yaxis.min, max: axes.yaxis.max }
      })
    );
  }

  function enableZoomOut() {
    var plot_pholder = plot.getPlaceholder();

    plot_pholder.on('click.rp', function(event) {
      var offset = $(event.target).offset();

      plot.zoomOut({
        center: { left: event.pageX - offset.left, top: event.pageY - offset.top },
        amount: 1.2
      });
    });

    // Disable zoom in selection and panning
    delete plot_options.selection;
    delete plot_options.pan;

    // Get current min/max for both axes to use them to fix the current view
    var axes = plot.getAxes();

    plot = $.plot(
      plot_pholder,
      plot.getData(),
      $.extend(true, plot_options, {
        xaxis: { min: axes.xaxis.min, max: axes.xaxis.max },
        yaxis: { min: axes.yaxis.min, max: axes.yaxis.max }
      })
    );
  }

  function enablePanning() {
    if(plot_options.hasOwnProperty('pan')) {
      return;
    }

    var plot_pholder = plot.getPlaceholder();

    // Disable selection zooming and zoom out
    delete plot_options.selection;
    plot_pholder.off('click.rp');

    // Get current min/max for both axes to use them to fix the current view
    var axes = plot.getAxes();

    plot = $.plot(
      plot_pholder,
      plot.getData(),
      $.extend(true, plot_options, {
        pan: { interactive: true },
        xaxis: { min: axes.xaxis.min, max: axes.xaxis.max },
        yaxis: { min: axes.yaxis.min, max: axes.yaxis.max }
      })
    );
  }

  function mouseDownMove(that, evt) {
    var y;
    user_editing = true;

    if(evt.type.indexOf('touch') > -1) {
      y = evt.originalEvent.touches[0].clientY - that.getBoundingClientRect().top - plot.getPlotOffset().top;
      touch_last_y = y;
    }
    else {
      y = evt.clientY - that.getBoundingClientRect().top - plot.getPlotOffset().top;
    }
    updateTriggerSlider(y);

    $('#trigger_tooltip').data('bs.tooltip').options.title = plot.getAxes().yaxis.c2p(y).toFixed(trigger_level_xdecimal_places);
    $('#trigger_tooltip').tooltip('show');
  }

  function mouseUpOut(evt) {
    if(trig_dragging) {
      trig_dragging = false;

      var y;
      if(evt.type.indexOf('touch') > -1) {
        //y = evt.originalEvent.touches[0].clientY - this.getBoundingClientRect().top - plot.getPlotOffset().top;
        y = touch_last_y;
      }
      else {
        y = evt.clientY - this.getBoundingClientRect().top - plot.getPlotOffset().top;
      }

      params.local.trig_level = parseFloat(plot.getAxes().yaxis.c2p(y).toFixed(trigger_level_xdecimal_places));

      updateTriggerSlider();
      redrawPlot();
      sendParams();
    }
    else {
      user_editing = false;
    }
    $('#trigger_tooltip').tooltip('hide');
  }

  function updateTriggerSlider(y, update_input) {
    if(! plot) {
      return;
    }

    var canvas = $('#trigger_canvas')[0];
    var context = canvas.getContext('2d');
    var plot_offset = plot.getPlotOffset();
    var ymax = params.original.gui_reset_y_range / 2;
    var ymin = ymax * -1;

    // If trigger level is outside the predefined ymin/ymax, change the level

    if(params.local.trig_level < ymin) {
      params.local.trig_level = ymin;
    }
    else if(params.local.trig_level > ymax) {
      params.local.trig_level = ymax;
    }

    if(y === undefined) {
      if(update_input !== false) {
        $('#trig_level').not(':focus').val(floatToLocalString(params.local.trig_level));
      }
      y = plot.getAxes().yaxis.p2c(params.local.trig_level);
    }

    // If trigger source is External or mode is not Normal or trigger level is not in visible area, do not show the trigger slider and paint the vertical line with gray
    context.clearRect(0, 0, canvas.width, canvas.height);
    var yaxis = plot.getAxes().yaxis;
    if(params.original.trig_mode != 1 || params.local.trig_level < yaxis.min || params.local.trig_level > yaxis.max || params.original.trig_source == 2) {
      context.lineWidth = 1;
      context.strokeStyle = '#dddddd';
      context.stroke();
      context.beginPath();
      context.moveTo(10, plot_offset.top);
      context.lineTo(10, canvas.height - plot_offset.bottom + 1);
      context.stroke();
    }
    else {
      context.beginPath();
      context.arc(10, y + plot_offset.top, 8, 0, 2 * Math.PI, false);
      context.fillStyle = '#009900';
      context.fill();
      context.lineWidth = 1;
      context.strokeStyle = '#007700';
      context.stroke();
      context.beginPath();
      context.moveTo(10, plot_offset.top);
      context.lineTo(10, canvas.height - plot_offset.bottom + 1);
      context.stroke();
    }
    $('#trigger_tooltip').css({ top: y + plot_offset.top });
  }

  function updateRanges() {
    var xunit = (params.local.time_units == 0 ? 's' : (params.local.time_units == 1 ? 'ms' : 's'));
    var yunit = 'V';
    var axes = plot.getAxes();
    var xrange = axes.xaxis.max - axes.xaxis.min;
    var yrange = axes.yaxis.max - axes.yaxis.min;
    var yminrange = 5e-3;  // Volts
    var ymaxrange = params.original.gui_reset_y_range;
    var xmaxrange = 10.0;  // seconds
    var xminrange = 20e-9; // seconds
    var decimals = 0;

    if(xunit == 's' && xrange < 1) {
      xrange *= 1000;
      xunit = 'ns';
    }
    if(xrange < 1) {
      decimals = 1;
    }
    var seconds = (xunit == 'ns' ? 1e-9 : ( xunit == 's' ? 1e-6 : (xunit == 'ms' ? 1e-3 : 1)));

    if(yrange < 1) {
      yunit = 'mV';
      yrange *= 1000;
      ymaxrange *= 1000;
      yminrange *= 1000;
    }

    $('#range_x').html(+(Math.round(xrange + "e+" + decimals) + "e-" + decimals) + ' ' + xunit);
    $('#range_y').html(Math.floor(yrange) + ' ' + yunit);

    var nearest_x = getNearestRanges(xrange);
    var nearest_y = getNearestRanges(yrange);

    // X limitations
    if(nearest_x.next * seconds > xmaxrange) {
      nearest_x.next = null;
      $('#range_x_plus').prop('disabled', true);
    }
    else {
      $('#range_x_plus').prop('disabled', false);
    }
    if(nearest_x.prev * seconds < xminrange) {
      nearest_x.prev = null;
      $('#range_x_minus').prop('disabled', true);
    }
    else {
      $('#range_x_minus').prop('disabled', false);
    }

    $('#range_x_minus').data({ nearest: nearest_x.prev, unit: xunit }).data('bs.tooltip').options.title = nearest_x.prev;
    $('#range_x_plus').data({ nearest: nearest_x.next, unit: xunit }).data('bs.tooltip').options.title = nearest_x.next;

    // Y limitations
    if(nearest_y.next - nearest_y.prev >= ymaxrange) {
      nearest_y.next = null;
      $('#range_y_plus').prop('disabled', true);
    }
    else {
      $('#range_y_plus').prop('disabled', false);
    }
    if(nearest_y.prev < yminrange) {
      nearest_y.prev = null;
      $('#range_y_minus').prop('disabled', true);
    }
    else {
      $('#range_y_minus').prop('disabled', false);
    }

    $('#range_y_minus').data({ nearest: nearest_y.prev, unit: yunit }).data('bs.tooltip').options.title = nearest_y.prev;
    $('#range_y_plus').data({ nearest: nearest_y.next, unit: yunit }).data('bs.tooltip').options.title = nearest_y.next;
  }

  function getNearestRanges(number) {
    var log10 = Math.floor(Math.log(number) / Math.LN10);
    var normalized = number / Math.pow(10, log10);
    var i = 0;
    var prev = null;
    var next = null;

    while(i < range_steps.length - 1) {
      var ratio = range_steps[i+1] / normalized;
      if(ratio > 0.99 && ratio < 1.01) {
        prev = range_steps[i];
        next = range_steps[i+2];
        break;
      }
      if(range_steps[i] < normalized && normalized < range_steps[i+1]) {
        prev = range_steps[i];
        next = range_steps[i+1];
        break;
      }
      i++;
    }

    return {
      prev: prev * Math.pow(10, log10),
      next: next * Math.pow(10, log10)
    };
  }

  function serverAutoScale() {
    params.local.auto_flag = 1;
    sendParams(true);
  }

  function getLocalDecimalSeparator() {
    var n = 1.1;
    return n.toLocaleString().substring(1,2);
  }

  function parseLocalFloat(num) {
    return +(num.replace(getLocalDecimalSeparator(), '.'));
  }

  function floatToLocalString(num) {
    // Workaround for a bug in Safari 6 (reference: https://github.com/mleibman/SlickGrid/pull/472)
    //return num.toString().replace('.', getLocalDecimalSeparator());
    return (num + '').replace('.', getLocalDecimalSeparator());
  }

 //added by patrick for integers
 function floatToLocalInt(float) {
 return float.toFixed(0);
 }

  function shortenFloat(value) {
    return value.toFixed(Math.abs(value) >= 10 ? 1 : 3);
  }

  function convertHz(value) {
    var unit = '';
    var decsep = getLocalDecimalSeparator();

    if(value >= 1e6) {
      value /= 1e6;
      unit = '<span class="unit">MHz</span>';
    }
    else if(value >= 1e3) {
      value /= 1e3;
      unit = '<span class="unit">kHz</span>';
    }
    else {
      unit = '<span class="unit">Hz</span>';
    }

    // Fix to 4 decimal digits in total regardless of the decimal point placement
    var eps = 1e-2;
    if (value >= 100 - eps) {
      value = value.toFixed(1);
    }
    else if  (value >= 10 - eps) {
      value = value.toFixed(2);
    }
    else {
      value = value.toFixed(3);
    }

    value = (value == 0 ? '---' + decsep + '-' : floatToLocalString(value));
    return value + unit;
  }

  function convertSec(value) {
    var unit = '';
    var decsep = getLocalDecimalSeparator();

    if(value < 1e-6) {
      value *= 1e9;
      unit = '<span class="unit">ns</span>';
    }
    else if(value < 1e-3) {
      value *= 1e6;
      unit = '<span class="unit">s</span>';
    }
    else if(value < 1) {
      value *= 1e3
      unit = '<span class="unit">ms</span>';
    }
    else {
      unit = '<span class="unit">s</span>';
    }

    // Fix to 4 decimal digits in total regardless of the decimal point placement
    var eps = 1e-2;
    if (value >= 100 - eps) {
      value = value.toFixed(1);
    }
    else if  (value >= 10 - eps) {
      value = value.toFixed(2);
    }
    else {
      value = value.toFixed(3);
    }

    value = (value == 0 ? '---' + decsep + '-' : floatToLocalString(value));
    return value + unit;
  }


  
  
  </script>
  <script src="../assets/redpitaya.custom.js"></script>
  
  
 
  
  
  
  
</head>
<body>
  <div class="header">
    <div class="container">
      <a id="btn_exit" class="pull-left" href="/index.html"><span class="glyphicon glyphicon-chevron-left" title="Exit" alt="Exit"></span></a>
      <img class="logo pull-left" src="../assets/images/logo_white.png">
      <h2 class="page-title">MPIK-PID Controller</h2>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div id="btn_toolbar" class="col-xs-12">
        <button id="btn_autoscale_y" class="btn btn-primary btn-lg" data-autozoom="false" onclick="autoscaleY()">
          <span class="glyphicon glyphicon-resize-vertical"></span> Autoscale
        </button>
        <button class="btn btn-primary btn-lg" onclick="resetZoom()">
          <span class="glyphicon glyphicon-retweet"></span> Reset zoom
        </button>
        <div id="selzoompan" class="btn-group" data-toggle="buttons">
          <button id="btn_zoomin" class="btn btn-primary" onclick="selectTool.call(this, 'zoomin')" style="display: none">
            <span class="glyphicon glyphicon-zoom-in"></span>
          </button>
          <button id="btn_zoomout" class="btn btn-default" onclick="selectTool.call(this, 'zoomout')" style="display: none">
            <span class="glyphicon glyphicon-zoom-out"></span>
          </button>
          <button id="btn_pan" class="btn btn-default" onclick="selectTool.call(this, 'pan')" style="display: none">
            <span class="glyphicon glyphicon-move"></span>
          </button>
          <button id="btn_zoompan" class="btn btn-primary btn-lg" onclick="selectTool.call(this, 'zoompan')" style="display: none">
            <span class="glyphicon glyphicon-search"></span><span class="glyphicon glyphicon-move"></span>
          </button>
        </div>
        <button id="btn_ch1" class="btn btn-primary btn-lg" data-checked="true" onclick="setVisibleChannels(this)">Channel 1</button>
        <button id="btn_ch2" class="btn btn-primary btn-lg" data-checked="true" onclick="setVisibleChannels(this)">Channel 2</button>			
        <button id="btn_auto" class="btn btn-primary btn-lg" onclick="serverAutoScale()">AUTO</button>
        <button id="btn_avg" class="btn btn-default btn-lg" onclick="setAvgAtDec()">Averaging</button>
      </div>
    </div>
	
	
    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-8">
	  <div class="row"> <!--------------- added by Fenske --->
        <div class="graph-holder well well-small">
          <div id="ytitle">Voltage [ V ]</div>
          <div id="trigger_cnv_holder">
            <canvas id="trigger_canvas" width="25" height="460"></canvas>
            <div id="trigger_tooltip"></div>
          </div>
          <div id="plot_holder"></div>
          <div id="xtitle"></div>
        </div>
	   </div> <!--------------- added by Fenske --->
<!--------------- Bar graphs by Fenske ------------------------------------------------------->
			<div class="row group-label">
                <div class="col-xs-6 col-sm-6 col-md-6" style="text-align: center">Output Channel 1</div>
                <div class="col-xs-6 col-sm-6 col-md-6" style="text-align: center">Output Channel 2</div>
			</div>	
			<div class="row">
                <div class="col-xs-6 col-sm-6 col-md-6" id="outputGraph_ch1"></div> 
				<div class="col-xs-2 col-sm-2 col-md-2"> </div>
				<div class="col-xs-6 col-sm-6 col-md-6" id="outputGraph_ch2"></div>
			</div>	
			<div class="row">  
				<div class="col-xs-6 col-sm-6 col-md-6" id="outputGraph_ch1_neg"></div>
				<div class="col-xs-2 col-sm-2 col-md-2"> </div>
				<div class="col-xs-6 col-sm-6 col-md-6" id="outputGraph_ch2_neg"></div>
			</div>
			<div class="row">
			</div>
			<div class="row">
				Note: Bar-graph is updated every 50 ms.
			</div>
<!--------------------- Bar graphs end ----------------------------------------------->
<!--------------- Image of pid ranges added by Fenske ------------------------------------------------------->
			<div class="row">
			</div>
			<div class="row group-label">
				<p style="color:white">Ranges of PID settings</p>
				<div class="col-xs-6 col-sm-6 col-md-6" style="text-align: left">Ranges of PID settings</div>
				<p style="color:white">Ranges of PID settings</p>
			</div>
			<div class="row">
				<img class="pid-ranges" src="img/ranges_pid.png">
			</div>
	  </div>

	  
      <div class="panel-group col-xs-12 col-sm-12 col-md-4" id="accordion">

<!------patrick-general-overview------>

<div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#gen_ov">
                General Overview
              </a>
            </h4>
          </div>
	<div id="gen_ov" class="panel-collapse collapse in">
            <div class="panel-body">
<div class="gotitle"><b>PID 11 Settings</b></div>
   <div class="goinfo">Lock [7]:</div>
	<div class="gosetting" id="pid11on" hidden><b style="color:green;" >ON</b></div>
	<div class="gosetting" id="pid11off"><b style="color:red;">OFF</b></div>
   <div class="goinfo">Scan [9]:</div>
   	<div class="gosetting" id="ch1on" hidden><b style="color:green;">ON</b></div>
   	<div class="gosetting" id="ch1off"><b style="color:red;">OFF</b></div>
   <div class="goinfo">Automatic Integrator Reset [1]:</div>
   	<div class="gosetting" id="arst11on" hidden><b style="color:green;">ON</b></div>
   	<div class="gosetting" id="arst11off"><b style="color:red;">OFF</b></div>
   <div class="goinfo">Min. Intensity Threshold [8],[2]:</div>
   	<div class="gosetting"><b id="info_min_i_threshold_1" style="color:blue;">1.000</b></div>

<div class="gotitle2"><b>Slow Piezo Correction Settings</b></div>
   <div class="goinfo">Slow Piezo Correction [3]:</div>
   	<div class="gosetting" id="pienon"hidden><b style="color:green;">ON</b></div>
   	<div class="gosetting" id="pienoff"><b style="color:red;">OFF</b></div>
  <div class="goinfo">Automatic Correction [5]:</div>
   	<div class="gosetting" id="pimanon"><b style="color:red;">OFF</b></div>
   	<div class="gosetting" id="pimanoff"hidden><b style="color:green;">ON</b></div>
   <div class="goinfo">Number of Steps [+],[-]:</div>
   	<div class="gosetting"><b id="info_manual_nop" style="color:blue;">1</b></div>
   <div class="goinfo">Laser Status:</div>
	<div class="gosetting" id="LLwaiting"><b style="color:orange;">Waiting for [3]!</b></div>
   	<div class="gosetting" id="LLon" hidden><b style="color:green;">Locked!</b></div>
   	<div class="gosetting" id="LLoff" hidden><b style="color:red;">Not Locked!</b></div>
   <div class="goinfo">Piezo Status:</div>
	<div class="gosetting" id="piezogo" hidden><b style="color:green;">Moving!</b></div>
	<div class="gosetting" id="piezono"><b style="color:red;">Stationary!</b></div>
	<div class="gosetting" id="piezogosoon" hidden><b style="color:orange;">Waiting for [3]!</b></div>

<div class="gotitle3"><b>Load And Save Settings</b></div>
<form class="form-horizontal" role="form" onsubmit="return false;">
			  <div class="form-group">
                  <div for="save_settings" class="col-xs-4 control-label">Save Setting:</div>
                  <div class="col-xs-8">
                    <select id="save_settings" class="form-control">
			<option value="0">Choose Setting</option>
                      <option value="1">Setting 1</option>
                      <option value="2">Setting 2</option>
                      <option value="3">Setting 3</option>
                    </select>
                  </div>
                </div>
				<div class="form-group">
                  <label for="load_settings" class="col-xs-4 control-label">Load Setting:	</label>
                  <div class="col-xs-8">
                    <select id="load_settings" class="form-control">
			<option value="0">Choose Setting</option>
                      <option value="1">Setting 1</option>
                      <option value="2">Setting 2</option>
                      <option value="3">Setting 3</option>
                    </select>
                  </div>
                </div>

	    </div>
	</div>
</div>

<!------patrick-general-overview-end-->

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#trigger">
                Trigger
              </a>
            </h4>
          </div>
          <div id="trigger" class="panel-collapse collapse">
            <div class="panel-body">
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="trig_source" class="col-xs-4 control-label">Source:</label>
                  <div class="col-xs-8">
                    <select id="trig_source" class="form-control">
                      <option value="0">Channel 1</option>
                      <option value="1">Channel 2</option>
                      <option value="2">External</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="trig_mode" class="col-xs-4 control-label">Mode:</label>
                  <div class="col-xs-8">
                    <select id="trig_mode" class="form-control">
                      <option value="0">Auto</option>
                      <option value="1">Normal</option>
                      <option value="2">Single</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="trig_edge" class="col-xs-4 control-label">Edge:</label>
                  <div class="col-xs-8">
                    <select id="trig_edge" class="form-control">
                      <option value="0">Rising</option>
                      <option value="1">Falling</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="trig_level" class="col-xs-4 control-label">Level:</label>
                  <div class="col-xs-5">
                    <input type="text" id="trig_level" value="0" class="form-control" autocomplete="off">
                    <span id="apply_trig_level" class="input-group-btn" style="display: none;">
                      <button class="btn btn-primary btn-lg" type="button"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div id="trig_lev_units" class="col-xs-3" style="padding: 7px 0 0;">V</div>
                </div>
              </form>
              <div class="row">
                <div class="col-xs-4"> </div>
                <div class="col-xs-5">
                  <button id="btn_single" class="btn btn-primary" onclick="singleUpdate()" disabled>
                    <span class="glyphicon glyphicon-step-forward"></span> Single
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#range">
                Range
              </a>
            </h4>
          </div>
          <div id="range" class="panel-collapse collapse">
            <div class="panel-body">
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label class="col-xs-4 col-sm-3 control-label" style="padding-top: 35px;">Range:</label>
                  <div class="col-xs-8 col-sm-9">
                    <div class="row">
                      <div class="col-xs-6 text-center">
                        <div class="group-label" style="padding-bottom: 10px;">X axis</div>
                        <div class="btn-group" style="margin-bottom: -3px;">
                          <button id="range_x_minus" type="button" class="btn btn-primary btn-lg range-btn-left">
                            <span class="glyphicon glyphicon-minus"></span>
                          </button>
                          <button id="range_x_plus" type="button" class="btn btn-primary btn-lg range-btn-right">
                            <span class="glyphicon glyphicon-plus"></span>
                          </button>
                        </div>
                        <div>
                          <span id="range_x" class="badge range-badge">-</span>
                        </div>
                      </div>
                      <div class="col-xs-6 text-center">
                        <div class="group-label" style="padding-bottom: 10px;">Y axis</div>
                        <div class="btn-group" style="margin-bottom: -3px;">
                          <button id="range_y_minus" type="button" class="btn btn-primary btn-lg range-btn-left">
                            <span class="glyphicon glyphicon-minus"></span>
                          </button>
                          <button id="range_y_plus" type="button" class="btn btn-primary btn-lg range-btn-right">
                            <span class="glyphicon glyphicon-plus"></span>
                          </button>
                        </div>
                        <div>
                          <span id="range_y" class="badge range-badge">-</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-xs-4 col-sm-3 control-label">Offset:</label>
                  <div class="col-xs-8 col-sm-9">
                    <div class="row">
                      <div class="col-xs-6 text-center">
                        <div class="btn-group" style="margin-bottom: -3px;">
                          <button id="offset_x_minus" type="button" class="btn btn-primary btn-lg range-btn-left">
                            <span class="glyphicon glyphicon-minus"></span>
                          </button>
                          <button id="offset_x_plus" type="button" class="btn btn-primary btn-lg range-btn-right">
                            <span class="glyphicon glyphicon-plus"></span>
                          </button>
                        </div>
                      </div>
                      <div class="col-xs-6 text-center">
                        <div class="btn-group" style="margin-bottom: -3px;">
                          <button id="offset_y_minus" type="button" class="btn btn-primary btn-lg range-btn-left">
                            <span class="glyphicon glyphicon-minus"></span>
                          </button>
                          <button id="offset_y_plus" type="button" class="btn btn-primary btn-lg range-btn-right">
                            <span class="glyphicon glyphicon-plus"></span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#measure">
                Measure
              </a>
            </h4>
          </div>
          <div id="measure" class="panel-collapse collapse">
            <div class="panel-body">
              <div class="row group-label">
                <div class="col-xs-6" style="text-align: center">Channel 1</div>
                <div class="col-xs-6" style="text-align: center">Channel 2</div> 	  
              </div> 
              <div class="row">
                <div class="col-xs-3 txt-right">Min:</div>
                <div class="col-xs-3"><span id="info_ch1_min">-</span><span class="unit">V</span></div>
                <div class="col-xs-3 txt-right">Min:</div>
                <div class="col-xs-3"><span id="info_ch2_min">-</span><span class="unit">V</span></div>
			  </div>
              <div class="row">
                <div class="col-xs-3 txt-right">Max:</div>
                <div class="col-xs-3"><span id="info_ch1_max">-</span><span class="unit">V</span></div>
                <div class="col-xs-3 txt-right">Max:</div>
                <div class="col-xs-3"><span id="info_ch2_max">-</span><span class="unit">V</span></div>
              </div>
              <div class="row">
                <div class="col-xs-3 txt-right">Amp:</div>
                <div class="col-xs-3"><span id="info_ch1_amp">-</span><span class="unit">Vpp</span></div>
                <div class="col-xs-3 txt-right">Amp:</div>
                <div class="col-xs-3"><span id="info_ch2_amp">-</span><span class="unit">Vpp</span></div>
              </div>
              <div class="row">
                <div class="col-xs-3 txt-right">Avg:</div>
                <div class="col-xs-3"><span id="info_ch1_avg">-</span><span class="unit">V</span></div>
                <div class="col-xs-3 txt-right">Avg:</div>
                <div class="col-xs-3"><span id="info_ch2_avg">-</span><span class="unit">V</span></div>
              </div>
              <div class="row">
                <div class="col-xs-3 txt-right">Freq:</div>
                <div class="col-xs-3" id="info_ch1_freq">-<span class="unit">Hz</span></div>
                <div class="col-xs-3 txt-right">Freq:</div>
                <div class="col-xs-3" id="info_ch2_freq">-<span class="unit">Hz</span></div>
              </div>
              <div class="row">
                <div class="col-xs-3 txt-right">Period:</div>
                <div class="col-xs-3" id="info_ch1_period">-<span class="unit">s</span></div>
                <div class="col-xs-3 txt-right">Period:</div>
                <div class="col-xs-3" id="info_ch2_period">-<span class="unit">s</span></div>
              </div>
	<!-------- Fenske bar graph output test ----------------->	
			  <div class="row group-label">
                <div class="col-xs-6" style="text-align: center">Output 1</div>
                <div class="col-xs-6" style="text-align: center">Output 2</div> 
			  </div>	
			  <div class="row">
                <div class="col-xs-3 txt-right">P:</div>
                <div class="col-xs-3"><span id="info_ch1_p">-</span><span class="unit">V</span></div>
                <div class="col-xs-3 txt-right">P:</div>
                <div class="col-xs-3"><span id="info_ch2_p">-</span><span class="unit">V</span></div>
              </div>
			  <div class="row">
                <div class="col-xs-3 txt-right">I:</div>
                <div class="col-xs-3"><span id="info_ch1_i">-</span><span class="unit">V</span></div>
                <div class="col-xs-3 txt-right">I:</div>
                <div class="col-xs-3"><span id="info_ch2_i">-</span><span class="unit">V</span></div>
              </div>
			  <div class="row">
                <div class="col-xs-3 txt-right">D:</div>
                <div class="col-xs-3"><span id="info_ch1_d">-</span><span class="unit">V</span></div>
                <div class="col-xs-3 txt-right">D:</div>
                <div class="col-xs-3"><span id="info_ch2_d">-</span><span class="unit">V</span></div>
              </div>
			  <div class="row">
                <div class="col-xs-3 txt-right">Out:</div>
                <div class="col-xs-3"><span id="info_ch1_o">-</span><span class="unit">V</span></div>
                <div class="col-xs-3 txt-right">Out:</div>
                <div class="col-xs-3"><span id="info_ch2_o">-</span><span class="unit">V</span></div>
              </div>
			  <div class="row">
                <div class="col-xs-3 txt-right">Rot_Encoder:</div>
                <div class="col-xs-3"><span id="rot_encoder">-</span><span class="unit">cnt</span></div>
              </div>
	<!-------- Fenske bar graph output test end ----------------->		  
            </div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#gain">
                Gain settings
              </a>
            </h4>
          </div>
          <div id="gain" class="panel-collapse collapse">
            <div class="panel-body">
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="group-label" style="padding-bottom: 10px;">Channel 1</div>
                <div class="form-group">
                  <label for="gain_ch1_att" class="col-xs-4 col-sm-6 control-label">Probe attenuation:</label>
                  <div class="col-xs-4 col-sm-5">
                    <select class="form-control" id="gain_ch1_att">
                      <option value="0">1x</option>
                      <option value="1">10x</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="gain_ch1_sett" class="col-xs-4 col-sm-6 control-label">Gain setting:</label>
                  <div class="col-xs-4 col-sm-5">
                    <select class="form-control" id="gain_ch1_sett">
                      <option value="0">LV</option>
                      <option value="1">HV</option>
                    </select>
                  </div>
                </div>
                <div class="group-label" style="padding: 10px 0;">Channel 2</div>
                <div class="form-group">
                  <label for="gain_ch2_att" class="col-xs-4 col-sm-6 control-label">Probe attenuation:</label>
                  <div class="col-xs-4 col-sm-5">
                    <select class="form-control" id="gain_ch2_att">
                      <option value="0">1x</option>
                      <option value="1">10x</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="gain_ch2_sett" class="col-xs-4 col-sm-6 control-label">Gain setting:</label>
                  <div class="col-xs-4 col-sm-5">
                    <select class="form-control" id="gain_ch2_sett">
                      <option value="0">LV</option>
                      <option value="1">HV</option>
                    </select>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#pid">
                PID Controller
              </a>
            </h4>
          </div>
          <div id="pid" class="panel-collapse collapse">
            <div class="panel-body">	
			<div>
			  Scroll down to see the ranges of the PID settings
			</div>
			<!-- Begin simple collapsible by Fenske ------------------------------------------->
			<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#pid_11_btn">PID 11</button>
			<div id="pid_11_btn" class="collapse">
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_11_enable" checked> PID 11 enable
                  </label>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_11_rst" checked> Integrator reset
                  </label>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_11_arst" checked> Automatic Integrator reset
                  </label>
                </div>
              </form>
		<!----------- Fenske------------------------------------------------------>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_gain" class="col-xs-4 control-label">Master-gain:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_gain">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_gain">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_gain_units"> </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_sp" class="col-xs-4 control-label">Setpoint:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_sp">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_sp">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_sp_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_kp" class="col-xs-4 control-label">Kp:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_kp">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_kp">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_kp_units"> </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_ki" class="col-xs-4 control-label">Ki:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_ki">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_ki">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_ki_units">1/ms</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_kii" class="col-xs-4 control-label">2. Ki:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_kii">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_kii">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_kii_units">1/ms</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_count_ki" class="col-xs-4 control-label">Slow I by:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_count_ki">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_count_ki">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_count_ki_units"> </div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_int_limit" class="col-xs-4 control-label">Integrator limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_int_limit">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_int_limit">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_limit_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_kd" class="col-xs-4 control-label">Kd:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_kd">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_kd">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_kd_units">ns</div>
                </div>
              </form>
			  <!------------ Output Limit added by Fenske ------------------------------------------------------------------------------>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_limit_up" class="col-xs-4 control-label">upper limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_limit_up">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_limit_up">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_limit_units">V</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_11_limit_low" class="col-xs-4 control-label">lower limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_11_limit_low">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_11_limit_low">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_11_limit_units">V</div>
                </div>
              </form>
			  </div> <!-- end simple collapsible by Fenske --------------------------------------->
			 <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#pid_12_btn">PID 12</button>
				<div id="pid_12_btn" class="collapse">
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_12_enable" checked> PID 12 enable
                  </label>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_12_rst" checked> Integrator reset
                  </label>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_12_arst" checked> Automatic Integrator reset
                  </label>
                </div>
              </form>
		
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_gain" class="col-xs-4 control-label">Master-gain:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_gain">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_gain">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_gain_units"> </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_sp" class="col-xs-4 control-label">Setpoint:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_sp">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_sp">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_sp_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_kp" class="col-xs-4 control-label">Kp:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_kp">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_kp">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_kp_units"> </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_ki" class="col-xs-4 control-label">Ki:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_ki">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_ki">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_ki_units">1/ms</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_kii" class="col-xs-4 control-label">2. Ki:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_kii">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_kii">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_kii_units">1/ms</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_count_ki" class="col-xs-4 control-label">Slow I by:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_count_ki">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_count_ki">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_count_ki_units"> </div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_int_limit" class="col-xs-4 control-label">Integrator limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_int_limit">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_int_limit">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_limit_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_kd" class="col-xs-4 control-label">Kd:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_kd">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_kd">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_kd_units">ns</div>
                </div>
              </form>
			 
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_limit_up" class="col-xs-4 control-label">upper limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_limit_up">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_limit_up">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_limit_units">V</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_12_limit_low" class="col-xs-4 control-label">lower limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_12_limit_low">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_12_limit_low">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_12_limit_units">V</div>
                </div>
              </form>
			  </div> <!-- end simple collapsible by Fenske --------------------------------------->
			  <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#pid_21_btn">PID 21</button>
				<div id="pid_21_btn" class="collapse">
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_21_enable" checked> PID 21 enable
                  </label>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_21_rst" checked> Integrator reset
                  </label>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_21_arst" checked> Automatic Integrator reset
                  </label>
                </div>
              </form>
		
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_gain" class="col-xs-4 control-label">Master-gain:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_gain">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_gain">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_gain_units"> </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_sp" class="col-xs-4 control-label">Setpoint:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_sp">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_sp">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_sp_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_kp" class="col-xs-4 control-label">Kp:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_kp">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_kp">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_kp_units"> </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_ki" class="col-xs-4 control-label">Ki:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_ki">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_ki">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_ki_units">1/ms</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_kii" class="col-xs-4 control-label">2. Ki:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_kii">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_kii">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_kii_units">1/ms</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_count_ki" class="col-xs-4 control-label">Slow I by</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_count_ki">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_count_ki">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_count_ki_units"> </div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_int_limit" class="col-xs-4 control-label">Integrator limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_int_limit">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_int_limit">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_limit_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_kd" class="col-xs-4 control-label">Kd:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_kd">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_kd">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_kd_units">ns</div>
                </div>
              </form>
			  
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_limit_up" class="col-xs-4 control-label">upper limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_limit_up">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_limit_up">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_limit_units">V</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_21_limit_low" class="col-xs-4 control-label">lower limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_21_limit_low">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_21_limit_low">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_21_limit_units">V</div>
                </div>
              </form>
			 </div> <!-- end simple collapsible by Fenske --------------------------------------->          
			  <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#pid_22_btn">PID 22</button>
				<div id="pid_22_btn" class="collapse">
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_22_enable" checked> PID 22 enable
                  </label>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_22_rst" checked> Integrator reset
                  </label>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="pid_22_arst" checked> Automatic Integrator reset
                  </label>
                </div>
              </form>
		<!--------- Fenske -------------->	  
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_gain" class="col-xs-4 control-label">Master-gain:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_gain">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_gain">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_gain_units"> </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_sp" class="col-xs-4 control-label">Setpoint:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_sp">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_sp">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_sp_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_kp" class="col-xs-4 control-label">Kp:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_kp">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_kp">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_kp_units"> </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_ki" class="col-xs-4 control-label">Ki:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_ki">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_ki">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_ki_units">1/ms</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_kii" class="col-xs-4 control-label">2. Ki:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_kii">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_kii">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_kii_units">1/ms</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_count_ki" class="col-xs-4 control-label">Slow I by:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_count_ki">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_count_ki">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_count_ki_units"> </div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_int_limit" class="col-xs-4 control-label">Integrator limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_int_limit">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_int_limit">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_limit_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_kd" class="col-xs-4 control-label">Kd:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_kd">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_kd">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_kd_units">ns</div>
                </div>
              </form>
			  <!------- 22-Limit Button added by Fenske------------------------------------------------------>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_limit_up" class="col-xs-4 control-label">upper limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_limit_up">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_limit_up">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_limit_units">V</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="pid_22_limit_low" class="col-xs-4 control-label">lower limit:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="pid_22_limit_low">
                    <span style="display: none;" class="input-group-btn" id="apply_pid_22_limit_low">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="pid_22_limit_units">V</div>
                </div>
              </form>
			  </div>
			  <div>
			  PID (Output/Input)
			  </div>		
			  <hr />
			  <!------- Output Offset Buttons added by Fenske------------------------------------------------------>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="out_1_offset" class="col-xs-4 control-label">Output 1 offset:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="out_1_offset">
                    <span style="display: none;" class="input-group-btn" id="apply_out_1_offset">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="out_offset_units">V</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="out_2_offset" class="col-xs-4 control-label">Output 2 offset:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="out_2_offset">
                    <span style="display: none;" class="input-group-btn" id="apply_out_2_offset">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="out_offset_units">V</div>
                </div>
              </form>
			  <hr />
			  <!------- Threshold for MIN_INTENSITY added by Fenske------------------------------------------------------>
			  <div>
			  Threshold for minimum intensity
			  </div>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="min_i_threshold_1" class="col-xs-4 control-label">Threshold 1:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="min_i_threshold_1">
                    <span style="display: none;" class="input-group-btn" id="apply_min_i_threshold_1">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="threshold_units">V</div>
                </div>
              </form>
			  <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="min_i_threshold_2" class="col-xs-4 control-label">Threshold 2:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="min_i_threshold_2">
                    <span style="display: none;" class="input-group-btn" id="apply_min_i_threshold_2">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="threshold_units">V</div>
                </div>
              </form>
			  <div class="row">
                <div class="col-xs-3 txt-right">Intensity 1:</div>
                <div class="col-xs-3"><span id="info_min_intens_1">-</span><span class="unit">V</span></div>
                <div class="col-xs-3 txt-right">Intensity 2:</div>
                <div class="col-xs-3"><span id="info_min_intens_2">-</span><span class="unit">V</span></div>
			  </div>
			  </hr>
			  <!------- Save and load settings buttons added by Fenske-----------------------------------------------------
			  <form clas>s="form-horizontal" role="form" onsubmit="return false;">
			  <div class="form-group">
                  <label for="save_settings" class="col-xs-4 control-label">Save as:</label>
                  <div class="col-xs-8">
                    <select id="save_settings" class="form-control">
					  <option value="0">---</option>
                      <option value="1">Setting 1</option>
                      <option value="2">Setting 2</option>
                      <option value="3">Setting 3</option>
                    </select>
                  </div>
                </div>
				<div class="form-group">
                  <label for="load_settings" class="col-xs-4 control-label">Load setting:</label>
                  <div class="col-xs-8">
                    <select id="load_settings" class="form-control">
					  <option value="0">---</option>
                      <option value="1">Setting 1</option>
                      <option value="2">Setting 2</option>
                      <option value="3">Setting 3</option>
                    </select>
                  </div>
                </div>---------------------- put into general overview by patrick------------>
		    </div>
          </div>
        </div>

<!--patrick - GUI-->
<div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#AO_piezo">
                Slow Piezo Correction And AO's
              </a>
            </h4>
          </div>
	<div id="AO_piezo" class="panel-collapse collapse">
            <div class="panel-body">
<!-- patrick - AO settings and piezo control-->

<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#piezo-drive">Slow Piezo Correction</button>
 <div id="piezo-drive" class="collapse">
  <form class="form-horizontal" role="form" onsubmit="return false;">
   <input type="checkbox" id="piezo_enable" accesskey="p" checked>
   <b>Enable Slow Piezo Correction</b>
   <aside>AO 0: TTL direction signal, AO 1: TTL pulse</aside>
  <br>
   <label>threshold up [V]: -1V up to 1V</label>
   <input type="text" autocomplete="off" class="form-control" value="0.85" id="AO_trsh_up">
   <label>threshold down [V]: -1V up to 1V</label>
   <input type="text" autocomplete="off" class="form-control" value="-0.4" id="AO_trsh_down">
   <input type="checkbox" id="slow_pulses" checked> :Use Slow Pulses with length: 30ms - 1000ms
   <input type="text" autocomplete="off" class="form-control" value="0" id="pulse_len">
  <br>
   <b>Manual Mode</b>
    <div>
   <input type="checkbox" id="piezo_manual" checked> :Stop Automatic Correction
    </div>
    <div>
   <input type="checkbox" id="manual_dir" checked> :Left/Right
    </div>
    <div>
   <input type="checkbox" id="manual_go" checked> :Move Piezo Stage
    </div>
   <h>Number of Steps (Pulses)</h>
   <input type="text" autocomplete="off" value="1" min="0" max="1000" id="manual_nop">
  </form>
</div>


<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#ll-variables">Advanced Laser Lock Settings</button>
 <div id="ll-variables" class="collapse">
  <form class="form-horizontal" role="form" onsubmit="return false;">
   <label><b>deviation checks:</b> number of true consecutive checks needed before the lock is confirmed:</label>
   <input type="text" autocomplete="off" class="form-control" value="100" min="0" max="100000" id="dev_checks">
   <label><b>allowed deviation:</b>maximum allowed deviation from start value in V:</label>
   <input type="text" autocomplete="off" class="form-control" value="0.05" min="0" max="1" id="dev_in_v">
   <label><b>reset value:</b> amount of deviation checks before the start value gets reset:</label>
   <input type="text" autocomplete="off" class="form-control" value="20" min="1" max="1000000" id="timerlimit">
  </form>
</div>


<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#ll-values">Advanced Laser Lock Info</button>
 <div id="ll-values" class="collapse">
  <form class="form-horizontal" role="form" onsubmit="return false;">
   <div>LL - 1 = locked, 0 = not locked:
    <div id="info_ll" style="background-color:BlanchedAlmond;"></div>
   </div>
   <label>LASER_LOCK_VALUE - consecutive times the value didn't deviate more than the allowed deviation from the start value:
    <div id="info_laser_lock_value" style="background-color:BlanchedAlmond;"></div></label>
   <label>LL_TIMER - runs from -1 to <label id="info_timerlimit"></label> and resets the start value:
    <div id="info_ll_timer" style="background-color:BlanchedAlmond;"></div></label>
   <label>VALUE0 - start value that gets reset after LL_TIMER resets:
    <div id="info_value0" style="background-color:BlanchedAlmond;"></div></label>
  <br>
  </form>
</div>


<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#AO-Outputs">Manually Setting Analog Outputs</button>
 <div id="AO-Outputs" class="collapse">
  <form class="form-horizontal" role="form" onsubmit="return false;">
   <div>
    pin 0: <input type="checkbox" id="AO_enable_pin0" checked>
    <input type="text" value="1" autocomplete="off" id="AO_vol_pin0">0V - 1.8V
   </div>
   <div>
    pin 1: <input type="checkbox" id="AO_enable_pin1" checked>
    <input type="text" autocomplete="off" value="1" id="AO_vol_pin1">0V - 1.8V
   </div>
   <div>
    pin 2: <input type="checkbox" id="AO_enable_pin2" checked>
    <input type="text" autocomplete="off" value="1" id="AO_vol_pin2">0V - 1.8V
   </div>
   <div>
    pin 3: <input type="checkbox" id="AO_enable_pin3" checked>
    <input type="text" autocomplete="off" value="1" id="AO_vol_pin3">0V - 1.8V
   </div>
  </div>
  </form>
<!-- patrick - end AO settings and piezo control -->
	    </div>
	</div>
        </div>
<!--patrick - GUI end-->

	     <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#generator">
                Signal generator
              </a>
            </h4>
          </div>
          <div id="generator" class="panel-collapse collapse">
            <div class="panel-body">
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="gen_enable_ch1" checked> Channel 1
                  </label>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch1_sigtype" class="col-xs-4 control-label">Signal type:</label>
                  <div class="col-xs-4 col-sm-7">
                    <select class="form-control" id="gen_ch1_sigtype">
                      <option value="0">Sine</option>
                      <option value="1">Square</option>
                      <option value="2">Triangle</option>
                      <option value="3">From file</option>
                    </select>
                  </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch1_ampl" class="col-xs-4 control-label">Amplitude:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="gen_ch1_ampl">
                    <span style="display: none;" class="input-group-btn" id="apply_gen_ch1_ampl">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="gen_ch1_ampl_units">Vpp</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch1_freq" class="col-xs-4 control-label">Frequency:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="gen_ch1_freq">
                    <span style="display: none;" class="input-group-btn" id="apply_gen_ch1_freq">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="gen_ch1_freq_units">Hz</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch1_dc" class="col-xs-4 control-label">DC offset:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="gen_ch1_dc">
                    <span style="display: none;" class="input-group-btn" id="apply_gen_ch1_dc">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="gen_ch1_dc_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch1_trigmode" class="col-xs-4 control-label" style="white-space: nowrap;">Trigger mode:</label>
                  <div class="col-xs-4 col-sm-7">
                    <select class="form-control" id="gen_ch1_trigmode">
                      <option value="0">Continuous</option>
                      <option value="1">Single</option>
                      <option value="2">External</option>
                    </select>
                  </div>
                </div>
              </form>
			  <!--------------- Disable Single- and File upload-button by Fenske	---------------------
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="row">
                  <div class="col-xs-8 col-md-12 col-lg-8 col-sm-offset-4 col-md-offset-0 col-lg-offset-4">
                    <button id="gen_ch1_single" class="btn btn-primary" onclick="return postGenSingle(1)">
                      <span class="glyphicon glyphicon-step-forward"></span> Single
                    </button>
                    <button id="gen_ch1_upload" class="btn btn-primary" onclick="return showUploadForm(1)">
                      <span class="glyphicon glyphicon-upload"></span> File upload
                    </button>
                  </div>
                </div>
              </form>
			  -------------------------------------------------------------------------------------------->
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="checkbox" style="padding-top: 15px; padding-bottom: 12px;">
                  <label class="group-label">
                    <input type="checkbox" id="gen_enable_ch2" checked> Channel 2
                  </label>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch2_sigtype" class="col-xs-4 control-label">Signal type:</label>
                  <div class="col-xs-4 col-sm-7">
                    <select class="form-control" id="gen_ch2_sigtype">
                      <option value="0">Sine</option>
                      <option value="1">Square</option>
                      <option value="2">Triangle</option>
                      <option value="3">From file</option>
                    </select>
                  </div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch2_ampl" class="col-xs-4 control-label">Amplitude:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="gen_ch2_ampl">
                    <span style="display: none;" class="input-group-btn" id="apply_gen_ch2_ampl">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="gen_ch2_ampl_units">Vpp</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch2_freq" class="col-xs-4 control-label">Frequency:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="gen_ch2_freq">
                    <span style="display: none;" class="input-group-btn" id="apply_gen_ch2_freq">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="gen_ch2_freq_units">Hz</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch2_dc" class="col-xs-4 control-label">DC offset:</label>
                  <div class="col-xs-4 col-sm-5">
                    <input type="text" autocomplete="off" class="form-control" value="0" id="gen_ch2_dc">
                    <span style="display: none;" class="input-group-btn" id="apply_gen_ch2_dc">
                      <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-ok-circle"></span></button>
                    </span>
                  </div>
                  <div style="padding: 7px 0 0;" class="col-xs-2" id="gen_ch2_dc_units">V</div>
                </div>
              </form>
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="form-group">
                  <label for="gen_ch2_trigmode" class="col-xs-4 control-label" style="white-space: nowrap;">Trigger mode:</label>
                  <div class="col-xs-4 col-sm-7">
                    <select class="form-control" id="gen_ch2_trigmode">
                      <option value="0">Continuous</option>
                      <option value="1">Single</option>
                      <option value="2">External</option>
                    </select>
                  </div>
                </div>
              </form>
			  <!--------------- Disable Single- and File upload-button by Fenske 	-----------------------
              <form class="form-horizontal" role="form" onsubmit="return false;">
                <div class="row">
                  <div class="col-xs-8 col-md-12 col-lg-8 col-sm-offset-4 col-md-offset-0 col-lg-offset-4">
                    <button id="gen_ch2_single" class="btn btn-primary" onclick="return postGenSingle(2)">
                      <span class="glyphicon glyphicon-step-forward"></span> Single
                    </button>
                    <button id="gen_ch2_upload" class="btn btn-primary" onclick="return showUploadForm(2)">
                      <span class="glyphicon glyphicon-upload"></span> File upload
                    </button>
                  </div>
                </div>
              </form>
			  ------------------------------------------------------------------------------------------>

  <div id="modal_err" class="modal" tabindex="-1" role="dialog" aria-labelledby="modal_err_label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="modal_err_label">Application error</h4>
        </div>
        <div class="modal-body"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default btn-close-modal" id="btn_ignore">Ignore</button>
          <button type="button" class="btn btn-default" id="btn_retry_get">Retry</button>
          <button type="button" class="btn btn-primary btn-app-restart">Restart</button>
        </div>
      </div>
    </div>
  </div>
  <div id="modal_app" class="modal" tabindex="-1" role="dialog" aria-labelledby="modal_app_label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="modal_app_label">Application stopped</h4>
        </div>
        <div class="modal-body">
          The <strong><span class="app-id"></span></strong> application was stopped. The current started application is <strong><span id="new_app_id"></span></strong>.<br />
          Do you want to switch to newly started application or to restart <strong><span class="app-id"></span></strong>?
        </div>
        <div class="modal-footer">
          <a href="/index.html" class="btn btn-danger pull-left">Exit app</a>
          <button type="button" class="btn btn-default" id="btn_switch_app">Switch</button>
          <button type="button" class="btn btn-primary btn-app-restart">Restart</button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
